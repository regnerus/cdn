"use strict";var htmlNamespace="http://www.w3.org/1999/xhtml";var cssStylingFlag=false;var defaultSingleLineContainerName="p";var globalRange=null;var commands={};function nextNode(a){if(a.hasChildNodes()){return a.firstChild}return nextNodeDescendants(a)}function previousNode(a){if(a.previousSibling){a=a.previousSibling;while(a.hasChildNodes()){a=a.lastChild}return a}if(a.parentNode&&a.parentNode.nodeType==Node.ELEMENT_NODE){return a.parentNode}return null}function nextNodeDescendants(a){while(a&&!a.nextSibling){a=a.parentNode}if(!a){return null}return a.nextSibling}function isAncestor(a,b){return a&&b&&Boolean(a.compareDocumentPosition(b)&Node.DOCUMENT_POSITION_CONTAINED_BY)}function isAncestorContainer(a,b){return(a||b)&&(a==b||isAncestor(a,b))}function isDescendant(b,a){return a&&b&&Boolean(a.compareDocumentPosition(b)&Node.DOCUMENT_POSITION_CONTAINED_BY)}function isBefore(b,a){return Boolean(b.compareDocumentPosition(a)&Node.DOCUMENT_POSITION_FOLLOWING)}function isAfter(b,a){return Boolean(b.compareDocumentPosition(a)&Node.DOCUMENT_POSITION_PRECEDING)}function getAncestors(b){var a=[];while(b.parentNode){a.unshift(b.parentNode);b=b.parentNode}return a}function getInclusiveAncestors(a){return getAncestors(a).concat(a)}function getDescendants(b){var c=[];var a=nextNodeDescendants(b);while((b=nextNode(b))&&b!=a){c.push(b)}return c}function getInclusiveDescendants(a){return[a].concat(getDescendants(a))}function convertProperty(a){var b={fontFamily:"font-family",fontSize:"font-size",fontStyle:"font-style",fontWeight:"font-weight",textDecoration:"text-decoration",};if(typeof b[a]!="undefined"){return b[a]}return a}function cssSizeToLegacy(a){return{"xx-small":1,small:2,medium:3,large:4,"x-large":5,"xx-large":6,"xxx-large":7}[a]}function legacySizeToCss(a){return{1:"xx-small",2:"small",3:"medium",4:"large",5:"x-large",6:"xx-large",7:"xxx-large",}[a]}function isHtmlNamespace(a){return a===null||a===htmlNamespace}function getDirectionality(a){if(a.dir=="ltr"){return"ltr"}if(a.dir=="rtl"){return"rtl"}if(!isHtmlElement(a.parentNode)){return"ltr"}return getDirectionality(a.parentNode)}function getNodeIndex(b){var a=0;while(b.previousSibling){a++;b=b.previousSibling}return a}function getNodeLength(a){switch(a.nodeType){case Node.PROCESSING_INSTRUCTION_NODE:case Node.DOCUMENT_TYPE_NODE:return 0;case Node.TEXT_NODE:case Node.COMMENT_NODE:return a.length;default:return a.childNodes.length}}function getPosition(d,b,c,a){if(d==c){if(b==a){return"equal"}if(b<a){return"before"}if(b>a){return"after"}}if(c.compareDocumentPosition(d)&Node.DOCUMENT_POSITION_FOLLOWING){var f=getPosition(c,a,d,b);if(f=="before"){return"after"}if(f=="after"){return"before"}}if(c.compareDocumentPosition(d)&Node.DOCUMENT_POSITION_CONTAINS){var e=c;while(e.parentNode!=d){e=e.parentNode}if(getNodeIndex(e)<b){return"after"}}return"before"}function getFurthestAncestor(b){var a=b;while(a.parentNode!=null){a=a.parentNode}return a}function isContained(d,a){var c=getPosition(d,0,a.startContainer,a.startOffset);var b=getPosition(d,getNodeLength(d),a.endContainer,a.endOffset);return getFurthestAncestor(d)==getFurthestAncestor(a.startContainer)&&c=="after"&&b=="before"}function getContainedNodes(a,e){if(typeof e=="undefined"){e=function(){return true}}var d=a.startContainer;if(d.hasChildNodes()&&a.startOffset<d.childNodes.length){d=d.childNodes[a.startOffset]}else{if(a.startOffset==getNodeLength(d)){d=nextNodeDescendants(d)}else{d=nextNode(d)}}var c=a.endContainer;if(c.hasChildNodes()&&a.endOffset<c.childNodes.length){c=c.childNodes[a.endOffset]}else{c=nextNodeDescendants(c)}var b=[];while(isBefore(d,c)){if(isContained(d,a)&&e(d)){b.push(d);d=nextNodeDescendants(d);continue}d=nextNode(d)}return b}function getAllContainedNodes(a,e){if(typeof e=="undefined"){e=function(){return true}}var d=a.startContainer;if(d.hasChildNodes()&&a.startOffset<d.childNodes.length){d=d.childNodes[a.startOffset]}else{if(a.startOffset==getNodeLength(d)){d=nextNodeDescendants(d)}else{d=nextNode(d)}}var c=a.endContainer;if(c.hasChildNodes()&&a.endOffset<c.childNodes.length){c=c.childNodes[a.endOffset]}else{c=nextNodeDescendants(c)}var b=[];while(isBefore(d,c)){if(isContained(d,a)&&e(d)){b.push(d)}d=nextNode(d)}return b}function normalizeColor(b){if(b.toLowerCase()=="currentcolor"){return null}if(normalizeColor.resultCache===undefined){normalizeColor.resultCache={}}if(normalizeColor.resultCache[b]!==undefined){return normalizeColor.resultCache[b]}var d=b;var a=document.createElement("span");document.body.appendChild(a);a.style.color="black";var c=document.createElement("span");a.appendChild(c);c.style.color=b;b=getComputedStyle(c).color;if(b=="rgb(0, 0, 0)"){a.color="white";b=getComputedStyle(c).color;if(b!="rgb(0, 0, 0)"){return normalizeColor.resultCache[d]=null}}document.body.removeChild(a);if(/^rgba\([0-9]+, [0-9]+, [0-9]+, 1\)$/.test(b)){return normalizeColor.resultCache[d]=b.replace("rgba","rgb").replace(", 1)",")")}if(b=="transparent"){return normalizeColor.resultCache[d]="rgba(0, 0, 0, 0)"}b=b.replace(/, 0.496094\)$/,", 0.5)");return normalizeColor.resultCache[d]=b}function parseSimpleColor(a){a=normalizeColor(a);var b=/^rgb\(([0-9]+), ([0-9]+), ([0-9]+)\)$/.exec(a);if(b){return"#"+parseInt(b[1]).toString(16).replace(/^.$/,"0$&")+parseInt(b[2]).toString(16).replace(/^.$/,"0$&")+parseInt(b[3]).toString(16).replace(/^.$/,"0$&")}return null}var executionStackDepth=0;function editCommandMethod(d,a,f){if(executionStackDepth==0&&typeof a!="undefined"){globalRange=a}else{if(executionStackDepth==0){globalRange=null;globalRange=getActiveRange()}}if(!(d in commands)){throw"NOT_SUPPORTED_ERR"}executionStackDepth++;try{var b=f()}catch(c){executionStackDepth--;throw c}executionStackDepth--;return b}function myExecCommand(d,c,b,a){d=d.toLowerCase();if(arguments.length==1||(arguments.length>=4&&typeof c=="undefined")){c=false}if(arguments.length<=2||(arguments.length>=4&&typeof b=="undefined")){b=""}return editCommandMethod(d,a,(function(g,f,e){return function(){if(!myQueryCommandEnabled(g)){return false}commands[g].action(e);return true}})(d,c,b))}function myQueryCommandEnabled(b,a){b=b.toLowerCase();return editCommandMethod(b,a,(function(c){return function(){return["copy","defaultparagraphseparator","selectall","stylewithcss","usecss"].indexOf(c)!=-1||(getActiveRange()!==null&&(isEditable(getActiveRange().startContainer)||isEditingHost(getActiveRange().startContainer))&&(isEditable(getActiveRange().endContainer)||isEditingHost(getActiveRange().endContainer))&&(getInclusiveAncestors(getActiveRange().commonAncestorContainer).some(isEditingHost)))}})(b))}function myQueryCommandIndeterm(b,a){b=b.toLowerCase();return editCommandMethod(b,a,(function(c){return function(){if(!("indeterm" in commands[c])){return false}return commands[c].indeterm()}})(b))}function myQueryCommandState(b,a){b=b.toLowerCase();return editCommandMethod(b,a,(function(c){return function(){if(!("state" in commands[c])){return false}if(typeof getStateOverride(c)!="undefined"){return getStateOverride(c)}return commands[c].state()}})(b))}function myQueryCommandSupported(a){a=a.toLowerCase();return a in commands}function myQueryCommandValue(b,a){b=b.toLowerCase();return editCommandMethod(b,a,function(){if(!("value" in commands[b])){return""}if(b=="fontsize"&&getValueOverride("fontsize")!==undefined){return getLegacyFontSize(getValueOverride("fontsize"))}if(typeof getValueOverride(b)!="undefined"){return getValueOverride(b)}return commands[b].value()})}function isHtmlElement(b,a){if(typeof a=="string"){a=[a]}if(typeof a=="object"){a=a.map(function(c){return c.toUpperCase()})}return b&&b.nodeType==Node.ELEMENT_NODE&&isHtmlNamespace(b.namespaceURI)&&(typeof a=="undefined"||a.indexOf(b.tagName)!=-1)}var prohibitedParagraphChildNames=["address","article","aside","blockquote","caption","center","col","colgroup","dd","details","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","li","listing","menu","nav","ol","p","plaintext","pre","section","summary","table","tbody","td","tfoot","th","thead","tr","ul","xmp"];function isProhibitedParagraphChild(a){return isHtmlElement(a,prohibitedParagraphChildNames)}function isBlockNode(a){return a&&((a.nodeType==Node.ELEMENT_NODE&&["inline","inline-block","inline-table","none"].indexOf(getComputedStyle(a).display)==-1)||a.nodeType==Node.DOCUMENT_NODE||a.nodeType==Node.DOCUMENT_FRAGMENT_NODE)}function isInlineNode(a){return a&&!isBlockNode(a)}function isEditingHost(a){return a&&isHtmlElement(a)&&(a.contentEditable=="true"||(a.parentNode&&a.parentNode.nodeType==Node.DOCUMENT_NODE&&a.parentNode.designMode=="on"))}function isEditable(a){return a&&!isEditingHost(a)&&(a.nodeType!=Node.ELEMENT_NODE||a.contentEditable!="false")&&(isEditingHost(a.parentNode)||isEditable(a.parentNode))&&(isHtmlElement(a)||(a.nodeType==Node.ELEMENT_NODE&&a.namespaceURI=="http://www.w3.org/2000/svg"&&a.localName=="svg")||(a.nodeType==Node.ELEMENT_NODE&&a.namespaceURI=="http://www.w3.org/1998/Math/MathML"&&a.localName=="math")||(a.nodeType!=Node.ELEMENT_NODE&&isHtmlElement(a.parentNode)))}function hasEditableDescendants(b){for(var a=0;a<b.childNodes.length;a++){if(isEditable(b.childNodes[a])||hasEditableDescendants(b.childNodes[a])){return true}}return false}function getEditingHostOf(b){if(isEditingHost(b)){return b}else{if(isEditable(b)){var a=b.parentNode;while(!isEditingHost(a)){a=a.parentNode}return a}else{return null}}}function inSameEditingHost(b,a){return getEditingHostOf(b)&&getEditingHostOf(b)==getEditingHostOf(a)}function isCollapsedLineBreak(b){if(!isHtmlElement(b,"br")){return false}var c=b.parentNode;while(getComputedStyle(c).display=="inline"){c=c.parentNode}var f=c.hasAttribute("style")?c.getAttribute("style"):null;c.style.height="auto";c.style.maxHeight="none";c.style.minHeight="0";var d=document.createTextNode("\u200b");var e=c.offsetHeight;if(e==0){throw"isCollapsedLineBreak: original height is zero, bug?"}b.parentNode.insertBefore(d,b.nextSibling);var a=c.offsetHeight;d.parentNode.removeChild(d);if(f===null){c.setAttribute("style","");c.removeAttribute("style")}else{c.setAttribute("style",f)}return e<a-5}function isExtraneousLineBreak(c){if(!isHtmlElement(c,"br")){return false}if(isHtmlElement(c.parentNode,"li")&&c.parentNode.childNodes.length==1){return false}var d=c.parentNode;while(getComputedStyle(d).display=="inline"){d=d.parentNode}var f=d.hasAttribute("style")?d.getAttribute("style"):null;d.style.height="auto";d.style.maxHeight="none";d.style.minHeight="0";var b=c.hasAttribute("style")?c.getAttribute("style"):null;var e=d.offsetHeight;if(e==0){throw"isExtraneousLineBreak: original height is zero, bug?"}c.setAttribute("style","display:none");var a=d.offsetHeight;if(f===null){d.setAttribute("style","");d.removeAttribute("style")}else{d.setAttribute("style",f)}if(b===null){c.removeAttribute("style")}else{c.setAttribute("style",b)}return e==a}function isWhitespaceNode(a){return a&&a.nodeType==Node.TEXT_NODE&&(a.data==""||(/^[\t\n\r ]+$/.test(a.data)&&a.parentNode&&a.parentNode.nodeType==Node.ELEMENT_NODE&&["normal","nowrap"].indexOf(getComputedStyle(a.parentNode).whiteSpace)!=-1)||(/^[\t\r ]+$/.test(a.data)&&a.parentNode&&a.parentNode.nodeType==Node.ELEMENT_NODE&&getComputedStyle(a.parentNode).whiteSpace=="pre-line"))}function isCollapsedWhitespaceNode(d){if(!isWhitespaceNode(d)){return false}if(d.data==""){return true}var c=d.parentNode;if(!c){return true}if(getAncestors(d).some(function(e){return e.nodeType==Node.ELEMENT_NODE&&getComputedStyle(e).display=="none"})){return true}while(!isBlockNode(c)&&c.parentNode){c=c.parentNode}var a=d;while(a!=c){a=previousNode(a);if(isBlockNode(a)||isHtmlElement(a,"br")){return true}if((a.nodeType==Node.TEXT_NODE&&!isWhitespaceNode(a))||isHtmlElement(a,"img")){break}}a=d;var b=nextNodeDescendants(c);while(a!=b){a=nextNode(a);if(isBlockNode(a)||isHtmlElement(a,"br")){return true}if((a&&a.nodeType==Node.TEXT_NODE&&!isWhitespaceNode(a))||isHtmlElement(a,"img")){break}}return false}function isVisible(b){if(!b){return false}if(getAncestors(b).concat(b).filter(function(c){return c.nodeType==Node.ELEMENT_NODE}).some(function(c){return getComputedStyle(c).display=="none"})){return false}if(isBlockNode(b)||(b.nodeType==Node.TEXT_NODE&&!isCollapsedWhitespaceNode(b))||isHtmlElement(b,"img")||(isHtmlElement(b,"br")&&!isExtraneousLineBreak(b))){return true}for(var a=0;a<b.childNodes.length;a++){if(isVisible(b.childNodes[a])){return true}}return false}function isInvisible(a){return a&&!isVisible(a)}function isCollapsedBlockProp(c){if(isCollapsedLineBreak(c)&&!isExtraneousLineBreak(c)){return true}if(!isInlineNode(c)||c.nodeType!=Node.ELEMENT_NODE){return false}var a=false;for(var b=0;b<c.childNodes.length;b++){if(!isInvisible(c.childNodes[b])&&!isCollapsedBlockProp(c.childNodes[b])){return false}if(isCollapsedBlockProp(c.childNodes[b])){a=true}}return a}function getActiveRange(){var a;if(globalRange){a=globalRange}else{if(getSelection().rangeCount){a=getSelection().getRangeAt(0)}else{return null}}if([Node.TEXT_NODE,Node.ELEMENT_NODE].indexOf(a.startContainer.nodeType)==-1||[Node.TEXT_NODE,Node.ELEMENT_NODE].indexOf(a.endContainer.nodeType)==-1||!a.startContainer.ownerDocument||!a.endContainer.ownerDocument||!isDescendant(a.startContainer,a.startContainer.ownerDocument)||!isDescendant(a.endContainer,a.endContainer.ownerDocument)){throw"Invalid active range; test bug?"}return a}var getStateOverride,setStateOverride,unsetStateOverride,getValueOverride,setValueOverride,unsetValueOverride;(function(){var c={};var b={};var a=null;function d(){if(!a||a.startContainer!=getActiveRange().startContainer||a.endContainer!=getActiveRange().endContainer||a.startOffset!=getActiveRange().startOffset||a.endOffset!=getActiveRange().endOffset){c={};b={};a=getActiveRange().cloneRange()}}getStateOverride=function(e){d();return c[e]};setStateOverride=function(f,e){d();c[f]=e};unsetStateOverride=function(e){d();delete c[e]};getValueOverride=function(e){d();return b[e]};setValueOverride=function(f,e){d();b[f]=e;if(f=="backcolor"){b.hilitecolor=e}else{if(f=="hilitecolor"){b.backcolor=e}}};unsetValueOverride=function(e){d();delete b[e];if(e=="backcolor"){delete b.hilitecolor}else{if(e=="hilitecolor"){delete b.backcolor}}}})();var extraRanges=[];function movePreservingRanges(b,j,h){if(h==-1){h=j.childNodes.length}var g=b.parentNode;var e=getNodeIndex(b);var a=[globalRange].concat(extraRanges);for(var c=0;c<getSelection().rangeCount;c++){a.push(getSelection().getRangeAt(c))}var f=[];a.forEach(function(i){f.push([i.startContainer,i.startOffset]);f.push([i.endContainer,i.endOffset])});f.forEach(function(i){if(i[0]==j&&i[1]>h){i[1]++}if(i[0]==g&&(i[1]==e||i[1]==e+1)){i[0]=j;i[1]+=h-e}if(i[0]==g&&i[1]>e+1){i[1]--}});if(j.childNodes.length==h){j.appendChild(b)}else{j.insertBefore(b,j.childNodes[h])}globalRange.setStart(f[0][0],f[0][1]);globalRange.setEnd(f[1][0],f[1][1]);for(var c=0;c<extraRanges.length;c++){extraRanges[c].setStart(f[2*c+2][0],f[2*c+2][1]);extraRanges[c].setEnd(f[2*c+3][0],f[2*c+3][1])}getSelection().removeAllRanges();for(var c=1+extraRanges.length;c<a.length;c++){var d=document.createRange();d.setStart(f[2*c][0],f[2*c][1]);d.setEnd(f[2*c+1][0],f[2*c+1][1]);getSelection().addRange(d)}}function setTagName(c,a){if(isHtmlElement(c,a.toUpperCase())){return c}if(!c.parentNode){return c}var d=c.ownerDocument.createElement(a);c.parentNode.insertBefore(d,c);for(var b=0;b<c.attributes.length;b++){d.setAttributeNS(c.attributes[b].namespaceURI,c.attributes[b].name,c.attributes[b].value)}while(c.childNodes.length){movePreservingRanges(c.firstChild,d,d.childNodes.length)}c.parentNode.removeChild(c);return d}function removeExtraneousLineBreaksBefore(b){var a=b.previousSibling;if(!a){return}while(a.hasChildNodes()){a=a.lastChild}while(isInvisible(a)&&!isExtraneousLineBreak(a)&&a!=b.parentNode){a=previousNode(a)}if(isEditable(a)&&isExtraneousLineBreak(a)){a.parentNode.removeChild(a)}}function removeExtraneousLineBreaksAtTheEndOf(b){var a=b;while(a.hasChildNodes()){a=a.lastChild}while(isInvisible(a)&&!isExtraneousLineBreak(a)&&a!=b){a=previousNode(a)}if(isEditable(a)&&isExtraneousLineBreak(a)){while(isEditable(a.parentNode)&&isInvisible(a.parentNode)){a=a.parentNode}a.parentNode.removeChild(a)}}function removeExtraneousLineBreaksFrom(a){removeExtraneousLineBreaksBefore(a);removeExtraneousLineBreaksAtTheEndOf(a)}function wrap(b,f,d){if(typeof f=="undefined"){f=function(){return false}}if(typeof d=="undefined"){d=function(){return null}}if(b.every(isInvisible)&&!b.some(function(g){return isHtmlElement(g,"br")})){return null}if(!b[0].parentNode){return null}if(isInlineNode(b[b.length-1])&&!isHtmlElement(b[b.length-1],"br")&&isHtmlElement(b[b.length-1].nextSibling,"br")){b.push(b[b.length-1].nextSibling)}while(isInvisible(b[0].previousSibling)){b.unshift(b[0].previousSibling)}while(isInvisible(b[b.length-1].nextSibling)){b.push(b[b.length-1].nextSibling)}var e;if(isEditable(b[0].previousSibling)&&f(b[0].previousSibling)){e=b[0].previousSibling}else{if(isEditable(b[b.length-1].nextSibling)&&f(b[b.length-1].nextSibling)){e=b[b.length-1].nextSibling}else{e=d()}}if(!e){return null}if(!e.parentNode){b[0].parentNode.insertBefore(e,b[0]);if(globalRange.startContainer==e.parentNode&&globalRange.startOffset==getNodeIndex(e)){globalRange.setStart(globalRange.startContainer,globalRange.startOffset+1)}if(globalRange.endContainer==e.parentNode&&globalRange.endOffset==getNodeIndex(e)){globalRange.setEnd(globalRange.endContainer,globalRange.endOffset+1)}}var a=b[0].parentNode;if(isBefore(e,b[0])){if(!isInlineNode(e)&&isInlineNode([].filter.call(e.childNodes,isVisible).slice(-1)[0])&&isInlineNode(b.filter(isVisible)[0])&&!isHtmlElement(e.lastChild,"BR")){e.appendChild(e.ownerDocument.createElement("br"))}for(var c=0;c<b.length;c++){movePreservingRanges(b[c],e,-1)}}else{if(!isInlineNode(e)&&isInlineNode([].filter.call(e.childNodes,isVisible)[0])&&isInlineNode(b.filter(isVisible).slice(-1)[0])&&!isHtmlElement(b[b.length-1],"BR")){e.insertBefore(e.ownerDocument.createElement("br"),e.firstChild)}for(var c=b.length-1;c>=0;c--){movePreservingRanges(b[c],e,0)}}if(isEditable(a)&&!a.hasChildNodes()){a.parentNode.removeChild(a)}if(isEditable(e.nextSibling)&&f(e.nextSibling)){if(!isInlineNode(e)&&isInlineNode(e.lastChild)&&isInlineNode(e.nextSibling.firstChild)&&!isHtmlElement(e.lastChild,"BR")){e.appendChild(e.ownerDocument.createElement("br"))}while(e.nextSibling.hasChildNodes()){movePreservingRanges(e.nextSibling.firstChild,e,-1)}e.parentNode.removeChild(e.nextSibling)}removeExtraneousLineBreaksFrom(e);return e}var namesOfElementsWithInlineContents=["a","abbr","b","bdi","bdo","cite","code","dfn","em","h1","h2","h3","h4","h5","h6","i","kbd","mark","p","pre","q","rp","rt","ruby","s","samp","small","span","strong","sub","sup","u","var","acronym","listing","strike","xmp","big","blink","font","marquee","nobr","tt"];function isElementWithInlineContents(a){return isHtmlElement(a,namesOfElementsWithInlineContents)}function isAllowedChild(e,a){if((["colgroup","table","tbody","tfoot","thead","tr"].indexOf(a)!=-1||isHtmlElement(a,["colgroup","table","tbody","tfoot","thead","tr"]))&&typeof e=="object"&&e.nodeType==Node.TEXT_NODE&&!/^[ \t\n\f\r]*$/.test(e.data)){return false}if((["script","style","plaintext","xmp"].indexOf(a)!=-1||isHtmlElement(a,["script","style","plaintext","xmp"]))&&(typeof e!="object"||e.nodeType!=Node.TEXT_NODE)){return false}if(typeof e=="object"&&(e.nodeType==Node.DOCUMENT_NODE||e.nodeType==Node.DOCUMENT_FRAGMENT_NODE||e.nodeType==Node.DOCUMENT_TYPE_NODE)){return false}if(isHtmlElement(e)){e=e.tagName.toLowerCase()}if(typeof e!="string"){return true}if(isHtmlElement(a)){var c=a;while(c){if(e=="a"&&isHtmlElement(c,"a")){return false}if(prohibitedParagraphChildNames.indexOf(e)!=-1&&isElementWithInlineContents(c)){return false}if(/^h[1-6]$/.test(e)&&isHtmlElement(c)&&/^H[1-6]$/.test(c.tagName)){return false}c=c.parentNode}a=a.tagName.toLowerCase()}if(typeof a=="object"&&(a.nodeType==Node.ELEMENT_NODE||a.nodeType==Node.DOCUMENT_FRAGMENT_NODE)){return true}if(typeof a!="string"){return false}switch(a){case"colgroup":return e=="col";case"table":return["caption","col","colgroup","tbody","td","tfoot","th","thead","tr"].indexOf(e)!=-1;case"tbody":case"thead":case"tfoot":return["td","th","tr"].indexOf(e)!=-1;case"tr":return["td","th"].indexOf(e)!=-1;case"dl":return["dt","dd"].indexOf(e)!=-1;case"dir":case"ol":case"ul":return["dir","li","ol","ul"].indexOf(e)!=-1;case"hgroup":return/^h[1-6]$/.test(e)}if(["body","caption","col","colgroup","frame","frameset","head","html","tbody","td","tfoot","th","thead","tr"].indexOf(e)!=-1){return false}if(["dd","dt"].indexOf(e)!=-1&&a!="dl"){return false}if(e=="li"&&a!="ol"&&a!="ul"){return false}var d=[[["a"],["a"]],[["dd","dt"],["dd","dt"]],[["h1","h2","h3","h4","h5","h6"],["h1","h2","h3","h4","h5","h6"]],[["li"],["li"]],[["nobr"],["nobr"]],[namesOfElementsWithInlineContents,prohibitedParagraphChildNames],[["td","th"],["caption","col","colgroup","tbody","td","tfoot","th","thead","tr"]],];for(var b=0;b<d.length;b++){if(d[b][0].indexOf(a)!=-1&&d[b][1].indexOf(e)!=-1){return false}}return true}function isEffectivelyContained(b,a){if(a.collapsed){return false}if(isContained(b,a)){return true}if(b==a.startContainer&&b.nodeType==Node.TEXT_NODE&&getNodeLength(b)!=a.startOffset){return true}if(b==a.endContainer&&b.nodeType==Node.TEXT_NODE&&a.endOffset!=0){return true}if(b.hasChildNodes()&&[].every.call(b.childNodes,function(c){return isEffectivelyContained(c,a)})&&(!isDescendant(a.startContainer,b)||a.startContainer.nodeType!=Node.TEXT_NODE||a.startOffset==0)&&(!isDescendant(a.endContainer,b)||a.endContainer.nodeType!=Node.TEXT_NODE||a.endOffset==getNodeLength(a.endContainer))){return true}return false}function getEffectivelyContainedNodes(a,e){if(typeof e=="undefined"){e=function(){return true}}var d=a.startContainer;while(isEffectivelyContained(d.parentNode,a)){d=d.parentNode}var c=nextNodeDescendants(a.endContainer);var b=[];while(isBefore(d,c)){if(isEffectivelyContained(d,a)&&e(d)){b.push(d);d=nextNodeDescendants(d);continue}d=nextNode(d)}return b}function getAllEffectivelyContainedNodes(a,e){if(typeof e=="undefined"){e=function(){return true}}var d=a.startContainer;while(isEffectivelyContained(d.parentNode,a)){d=d.parentNode}var c=nextNodeDescendants(a.endContainer);var b=[];while(isBefore(d,c)){if(isEffectivelyContained(d,a)&&e(d)){b.push(d)}d=nextNode(d)}return b}function isModifiableElement(b){if(!isHtmlElement(b)){return false}if(["B","EM","I","S","SPAN","STRIKE","STRONG","SUB","SUP","U"].indexOf(b.tagName)!=-1){if(b.attributes.length==0){return true}if(b.attributes.length==1&&b.hasAttribute("style")){return true}}if(b.tagName=="FONT"||b.tagName=="A"){var a=b.attributes.length;if(b.hasAttribute("style")){a--}if(b.tagName=="FONT"){if(b.hasAttribute("color")){a--}if(b.hasAttribute("face")){a--}if(b.hasAttribute("size")){a--}}if(b.tagName=="A"&&b.hasAttribute("href")){a--}if(a==0){return true}}return false}function isSimpleModifiableElement(a){if(!isHtmlElement(a)){return false}if(["A","B","EM","FONT","I","S","SPAN","STRIKE","STRONG","SUB","SUP","U"].indexOf(a.tagName)==-1){return false}if(a.attributes.length==0){return true}if(a.attributes.length>1){return false}if(a.hasAttribute("style")&&a.style.length==0){return true}if(a.tagName=="A"&&a.hasAttribute("href")){return true}if(a.tagName=="FONT"&&(a.hasAttribute("color")||a.hasAttribute("face")||a.hasAttribute("size"))){return true}if((a.tagName=="B"||a.tagName=="STRONG")&&a.hasAttribute("style")&&a.style.length==1&&a.style.fontWeight!=""){return true}if((a.tagName=="I"||a.tagName=="EM")&&a.hasAttribute("style")&&a.style.length==1&&a.style.fontStyle!=""){return true}if((a.tagName=="A"||a.tagName=="FONT"||a.tagName=="SPAN")&&a.hasAttribute("style")&&a.style.length==1&&a.style.textDecoration==""){return true}if(["A","FONT","S","SPAN","STRIKE","U"].indexOf(a.tagName)!=-1&&a.hasAttribute("style")&&(a.style.length==1||(a.style.length==4&&"MozTextBlink" in a.style&&"MozTextDecorationColor" in a.style&&"MozTextDecorationLine" in a.style&&"MozTextDecorationStyle" in a.style))&&(a.style.textDecoration=="line-through"||a.style.textDecoration=="underline"||a.style.textDecoration=="overline"||a.style.textDecoration=="none")){return true}return false}function isFormattableNode(a){return isEditable(a)&&isVisible(a)&&(a.nodeType==Node.TEXT_NODE||isHtmlElement(a,["img","br"]))}function areEquivalentValues(c,b,a){if(b===null&&a===null){return true}if(typeof b=="string"&&typeof a=="string"&&b==a&&!("equivalentValues" in commands[c])){return true}if(typeof b=="string"&&typeof a=="string"&&"equivalentValues" in commands[c]&&commands[c].equivalentValues(b,a)){return true}return false}function areLooselyEquivalentValues(e,d,c){if(areEquivalentValues(e,d,c)){return true}if(e!="fontsize"||typeof d!="string"||typeof c!="string"){return false}var b=areLooselyEquivalentValues;if(b.sizeMap===undefined){b.sizeMap={};var a=document.createElement("font");document.body.appendChild(a);["xx-small","small","medium","large","x-large","xx-large","xxx-large"].forEach(function(f){a.size=cssSizeToLegacy(f);b.sizeMap[f]=getComputedStyle(a).fontSize});document.body.removeChild(a)}return d===b.sizeMap[c]||c===b.sizeMap[d]}function getEffectiveCommandValue(b,d){if(b.nodeType!=Node.ELEMENT_NODE&&(!b.parentNode||b.parentNode.nodeType!=Node.ELEMENT_NODE)){return null}if(b.nodeType!=Node.ELEMENT_NODE){return getEffectiveCommandValue(b.parentNode,d)}if(d=="createlink"||d=="unlink"){while(b&&(!isHtmlElement(b)||b.tagName!="A"||!b.hasAttribute("href"))){b=b.parentNode}if(!b){return null}return b.getAttribute("href")}if(d=="backcolor"||d=="hilitecolor"){while((getComputedStyle(b).backgroundColor=="rgba(0, 0, 0, 0)"||getComputedStyle(b).backgroundColor===""||getComputedStyle(b).backgroundColor=="transparent")&&b.parentNode&&b.parentNode.nodeType==Node.ELEMENT_NODE){b=b.parentNode}return getComputedStyle(b).backgroundColor}if(d=="subscript"||d=="superscript"){var a=false;var c=false;while(isInlineNode(b)){var e=getComputedStyle(b).verticalAlign;if(isHtmlElement(b,"sub")){a=true}else{if(isHtmlElement(b,"sup")){c=true}}b=b.parentNode}if(a&&c){return"mixed"}if(a){return"subscript"}if(c){return"superscript"}return null}if(d=="strikethrough"){do{if(getComputedStyle(b).textDecoration.indexOf("line-through")!=-1){return"line-through"}b=b.parentNode}while(b&&b.nodeType==Node.ELEMENT_NODE);return null}if(d=="underline"){do{if(getComputedStyle(b).textDecoration.indexOf("underline")!=-1){return"underline"}b=b.parentNode}while(b&&b.nodeType==Node.ELEMENT_NODE);return null}if(!("relevantCssProperty" in commands[d])){throw"Bug: no relevantCssProperty for "+d+" in getEffectiveCommandValue"}return getComputedStyle(b)[commands[d].relevantCssProperty]}function getSpecifiedCommandValue(b,d){if((d=="backcolor"||d=="hilitecolor")&&getComputedStyle(b).display!="inline"){return null}if(d=="createlink"||d=="unlink"){if(isHtmlElement(b)&&b.tagName=="A"&&b.hasAttribute("href")){return b.getAttribute("href")}return null}if(d=="subscript"||d=="superscript"){if(isHtmlElement(b,"sup")){return"superscript"}if(isHtmlElement(b,"sub")){return"subscript"}return null}if(d=="strikethrough"&&b.style.textDecoration!=""){if(b.style.textDecoration.indexOf("line-through")!=-1){return"line-through"}return null}if(d=="strikethrough"&&isHtmlElement(b,["S","STRIKE"])){return"line-through"}if(d=="underline"&&b.style.textDecoration!=""){if(b.style.textDecoration.indexOf("underline")!=-1){return"underline"}return null}if(d=="underline"&&isHtmlElement(b,"U")){return"underline"}var c=commands[d].relevantCssProperty;if(c===null){return null}if(b.style[c]!=""){return b.style[c]}if(isHtmlNamespace(b.namespaceURI)&&b.tagName=="FONT"){if(c=="color"&&b.hasAttribute("color")){return b.color}if(c=="fontFamily"&&b.hasAttribute("face")){return b.face}if(c=="fontSize"&&b.hasAttribute("size")){var a=parseInt(b.size);if(a<1){a=1}if(a>7){a=7}return{1:"xx-small",2:"small",3:"medium",4:"large",5:"x-large",6:"xx-large",7:"xxx-large"}[a]}}if(c=="fontWeight"&&(b.tagName=="B"||b.tagName=="STRONG")){return"bold"}if(c=="fontStyle"&&(b.tagName=="I"||b.tagName=="EM")){return"italic"}return null}function reorderModifiableDescendants(b,d,c){var a=b;while(isModifiableElement(a)&&a.childNodes.length==1&&isModifiableElement(a.firstChild)&&(!isSimpleModifiableElement(a)||!areEquivalentValues(d,getSpecifiedCommandValue(a,d),c))){a=a.firstChild}if(a==b||!isSimpleModifiableElement(a)||!areEquivalentValues(d,getSpecifiedCommandValue(a,d),c)||!areLooselyEquivalentValues(d,getEffectiveCommandValue(a,d),c)){return}while(a.hasChildNodes()){movePreservingRanges(a.firstChild,a.parentNode,getNodeIndex(a))}b.parentNode.insertBefore(a,b.nextSibling);movePreservingRanges(b,a,-1)}function recordValues(b){var a=[];b.forEach(function(c){["subscript","bold","fontname","fontsize","forecolor","hilitecolor","italic","strikethrough","underline"].forEach(function(e){var d=c;if(d.nodeType!=Node.ELEMENT_NODE){d=d.parentNode}while(d&&d.nodeType==Node.ELEMENT_NODE&&getSpecifiedCommandValue(d,e)===null){d=d.parentNode}if(d&&d.nodeType==Node.ELEMENT_NODE){a.push([c,e,getSpecifiedCommandValue(d,e)])}else{a.push([c,e,null])}})});return a}function restoreValues(a){a.forEach(function(f){var c=f[0];var e=f[1];var d=f[2];var b=c;if(!b||b.nodeType!=Node.ELEMENT_NODE){b=b.parentNode}while(b&&b.nodeType==Node.ELEMENT_NODE&&getSpecifiedCommandValue(b,e)===null){b=b.parentNode}if(d===null&&b&&b.nodeType==Node.ELEMENT_NODE){pushDownValues(c,e,null)}else{if((b&&b.nodeType==Node.ELEMENT_NODE&&!areEquivalentValues(e,getSpecifiedCommandValue(b,e),d))||((!b||b.nodeType!=Node.ELEMENT_NODE)&&d!==null)){forceValue(c,e,d)}}})}function clearValue(c,d){if(!isEditable(c)){return[]}if(getSpecifiedCommandValue(c,d)===null){return[]}if(isSimpleModifiableElement(c)){var b=Array.prototype.slice.call(c.childNodes);for(var a=0;a<b.length;a++){movePreservingRanges(b[a],c.parentNode,getNodeIndex(c))}c.parentNode.removeChild(c);return b}if(d=="strikethrough"&&c.style.textDecoration.indexOf("line-through")!=-1){if(c.style.textDecoration=="line-through"){c.style.textDecoration=""}else{c.style.textDecoration=c.style.textDecoration.replace("line-through","")}if(c.getAttribute("style")==""){c.removeAttribute("style")}}if(d=="underline"&&c.style.textDecoration.indexOf("underline")!=-1){if(c.style.textDecoration=="underline"){c.style.textDecoration=""}else{c.style.textDecoration=c.style.textDecoration.replace("underline","")}if(c.getAttribute("style")==""){c.removeAttribute("style")}}if(commands[d].relevantCssProperty!==null){c.style[commands[d].relevantCssProperty]="";if(c.getAttribute("style")==""){c.removeAttribute("style")}}if(isHtmlNamespace(c.namespaceURI)&&c.tagName=="FONT"){if(d=="forecolor"){c.removeAttribute("color")}if(d=="fontname"){c.removeAttribute("face")}if(d=="fontsize"){c.removeAttribute("size")}}if(isHtmlElement(c,"A")&&(d=="createlink"||d=="unlink")){c.removeAttribute("href")}if(getSpecifiedCommandValue(c,d)===null){return[]}return[setTagName(c,"span")]}function pushDownValues(d,f,a){if(!d.parentNode||d.parentNode.nodeType!=Node.ELEMENT_NODE){return}if(areLooselyEquivalentValues(f,getEffectiveCommandValue(d,f),a)){return}var e=d.parentNode;var j=[];while(isEditable(e)&&e.nodeType==Node.ELEMENT_NODE&&!areLooselyEquivalentValues(f,getEffectiveCommandValue(e,f),a)){j.push(e);e=e.parentNode}if(!j.length){return}var h=getSpecifiedCommandValue(j[j.length-1],f);if(h===null&&h!=a){return}if(a!==null&&!areLooselyEquivalentValues(f,getEffectiveCommandValue(j[j.length-1].parentNode,f),a)){return}while(j.length){var e=j.pop();if(getSpecifiedCommandValue(e,f)!==null){h=getSpecifiedCommandValue(e,f)}var c=Array.prototype.slice.call(e.childNodes);if(getSpecifiedCommandValue(e,f)!==null){clearValue(e,f)}for(var g=0;g<c.length;g++){var b=c[g];if(b==d){continue}if(b.nodeType==Node.ELEMENT_NODE&&getSpecifiedCommandValue(b,f)!==null&&!areEquivalentValues(f,h,getSpecifiedCommandValue(b,f))){continue}if(b==j[j.length-1]){continue}forceValue(b,f,h)}}}function forceValue(c,d,a){if(!c.parentNode){return}if(a===null){return}if(isAllowedChild(c,"span")){reorderModifiableDescendants(c.previousSibling,d,a);reorderModifiableDescendants(c.nextSibling,d,a);wrap([c],function(i){return isSimpleModifiableElement(i)&&areEquivalentValues(d,getSpecifiedCommandValue(i,d),a)&&areLooselyEquivalentValues(d,getEffectiveCommandValue(i,d),a)},function(){return null})}if(isInvisible(c)){return}if(areLooselyEquivalentValues(d,getEffectiveCommandValue(c,d),a)){return}if(!isAllowedChild(c,"span")){var b=[];for(var e=0;e<c.childNodes.length;e++){if(c.childNodes[e].nodeType==Node.ELEMENT_NODE){var f=getSpecifiedCommandValue(c.childNodes[e],d);if(f!==null&&!areEquivalentValues(d,a,f)){continue}}b.push(c.childNodes[e])}for(var e=0;e<b.length;e++){forceValue(b[e],d,a)}return}if(areLooselyEquivalentValues(d,getEffectiveCommandValue(c,d),a)){return}var j=null;if(!cssStylingFlag){if(d=="bold"&&(a=="bold"||a=="700")){j=c.ownerDocument.createElement("strong")}if(d=="italic"&&a=="italic"){j=c.ownerDocument.createElement("em")}if(d=="strikethrough"&&a=="line-through"){j=c.ownerDocument.createElement("s")}if(d=="underline"&&a=="underline"){j=c.ownerDocument.createElement("u")}if(d=="forecolor"&&parseSimpleColor(a)){j=c.ownerDocument.createElement("font");j.setAttribute("color",parseSimpleColor(a))}if(d=="fontname"){j=c.ownerDocument.createElement("font");j.face=a}}if(d=="createlink"||d=="unlink"){j=c.ownerDocument.createElement("a");j.setAttribute("href",a);var g=c.parentNode;while(g){if(isHtmlElement(g,"A")){g=setTagName(g,"span")}g=g.parentNode}}if(d=="fontsize"&&["xx-small","small","medium","large","x-large","xx-large","xxx-large"].indexOf(a)!=-1&&(!cssStylingFlag||a=="xxx-large")){j=c.ownerDocument.createElement("font");j.size=cssSizeToLegacy(a)}if((d=="subscript"||d=="superscript")&&a=="subscript"){j=c.ownerDocument.createElement("sub")}if((d=="subscript"||d=="superscript")&&a=="superscript"){j=c.ownerDocument.createElement("sup")}if(!j){j=c.ownerDocument.createElement("span")}c.parentNode.insertBefore(j,c);var h=commands[d].relevantCssProperty;if(h!==null&&!areLooselyEquivalentValues(d,getEffectiveCommandValue(j,d),a)){j.style[h]=a}if(d=="strikethrough"&&a=="line-through"&&getEffectiveCommandValue(j,"strikethrough")!="line-through"){j.style.textDecoration="line-through"}if(d=="underline"&&a=="underline"&&getEffectiveCommandValue(j,"underline")!="underline"){j.style.textDecoration="underline"}movePreservingRanges(c,j,j.childNodes.length);if(c.nodeType==Node.ELEMENT_NODE&&!areEquivalentValues(d,getEffectiveCommandValue(c,d),a)){movePreservingRanges(c,j.parentNode,getNodeIndex(j));j.parentNode.removeChild(j);var b=[];for(var e=0;e<c.childNodes.length;e++){if(c.childNodes[e].nodeType==Node.ELEMENT_NODE){var f=getSpecifiedCommandValue(c.childNodes[e],d);if(f!==null&&!areEquivalentValues(d,a,f)){continue}}b.push(c.childNodes[e])}for(var e=0;e<b.length;e++){forceValue(b[e],d,a)}}}function setSelectionValue(g,d){if(!getAllEffectivelyContainedNodes(getActiveRange()).some(isFormattableNode)){if("inlineCommandActivatedValues" in commands[g]){setStateOverride(g,commands[g].inlineCommandActivatedValues.indexOf(d)!=-1)}if(g=="subscript"){unsetStateOverride("superscript")}if(g=="superscript"){unsetStateOverride("subscript")}if(d===null){unsetValueOverride(g)}else{if(g=="createlink"||"value" in commands[g]){setValueOverride(g,d)}}return}if(isEditable(getActiveRange().startContainer)&&getActiveRange().startContainer.nodeType==Node.TEXT_NODE&&getActiveRange().startOffset!=0&&getActiveRange().startOffset!=getNodeLength(getActiveRange().startContainer)){var f=document.createRange();var b;if(getActiveRange().startContainer==getActiveRange().endContainer){var e=getActiveRange().endOffset-getActiveRange().startOffset;b=getActiveRange().startContainer.splitText(getActiveRange().startOffset);f.setEnd(b,e);getActiveRange().setEnd(b,e)}else{b=getActiveRange().startContainer.splitText(getActiveRange().startOffset)}f.setStart(b,0);getSelection().removeAllRanges();getSelection().addRange(f);getActiveRange().setStart(b,0)}if(isEditable(getActiveRange().endContainer)&&getActiveRange().endContainer.nodeType==Node.TEXT_NODE&&getActiveRange().endOffset!=0&&getActiveRange().endOffset!=getNodeLength(getActiveRange().endContainer)){var h=getActiveRange();var a=[h.startContainer,h.startOffset];var c=[h.endContainer,h.endOffset];h.endContainer.splitText(h.endOffset);h.setStart(a[0],a[1]);h.setEnd(c[0],c[1]);getSelection().removeAllRanges();getSelection().addRange(h)}getAllEffectivelyContainedNodes(getActiveRange(),function(i){return isEditable(i)&&i.nodeType==Node.ELEMENT_NODE}).forEach(function(i){clearValue(i,g)});getAllEffectivelyContainedNodes(getActiveRange(),isEditable).forEach(function(i){pushDownValues(i,g,d);if(isAllowedChild(i,"span")){forceValue(i,g,d)}})}commands.backcolor={action:function(a){if(/^([0-9a-fA-F]{3}){1,2}$/.test(a)){a="#"+a}if(!/^(rgba?|hsla?)\(.*\)$/.test(a)&&!parseSimpleColor(a)&&a.toLowerCase()!="transparent"){return}setSelectionValue("backcolor",a)},standardInlineValueCommand:true,relevantCssProperty:"backgroundColor",equivalentValues:function(b,a){return normalizeColor(b)===normalizeColor(a)},};commands.bold={action:function(){if(myQueryCommandState("bold")){setSelectionValue("bold","normal")}else{setSelectionValue("bold","bold")}},inlineCommandActivatedValues:["bold","600","700","800","900"],relevantCssProperty:"fontWeight",equivalentValues:function(b,a){return b==a||(b=="bold"&&a=="700")||(b=="700"&&a=="bold")||(b=="normal"&&a=="400")||(b=="400"&&a=="normal")},};commands.createlink={action:function(a){if(a===""){return}getAllEffectivelyContainedNodes(getActiveRange()).forEach(function(b){getAncestors(b).forEach(function(c){if(isEditable(c)&&isHtmlElement(c,"a")&&c.hasAttribute("href")){c.setAttribute("href",a)}})});setSelectionValue("createlink",a)}};commands.fontname={action:function(a){setSelectionValue("fontname",a)},standardInlineValueCommand:true,relevantCssProperty:"fontFamily"};function normalizeFontSize(b){b=b.trim();if(!/^[-+]?[0-9]+(\.[0-9]+)?([eE][-+]?[0-9]+)?$/.test(b)){return null}var c;if(b[0]=="+"){b=b.slice(1);c="relative-plus"}else{if(b[0]=="-"){b=b.slice(1);c="relative-minus"}else{c="absolute"}}var a=parseInt(b);if(c=="relative-plus"){a+=3}if(c=="relative-minus"){a=3-a}if(a<1){a=1}if(a>7){a=7}b={1:"xx-small",2:"small",3:"medium",4:"large",5:"x-large",6:"xx-large",7:"xxx-large"}[a];return b}commands.fontsize={action:function(a){a=normalizeFontSize(a);if(a===null){return}setSelectionValue("fontsize",a)},indeterm:function(){return getAllEffectivelyContainedNodes(getActiveRange(),isFormattableNode).map(function(a){return getEffectiveCommandValue(a,"fontsize")}).filter(function(c,b,a){return a.slice(0,b).indexOf(c)==-1}).length>=2},value:function(){if(!getActiveRange()){return""}var b=getAllEffectivelyContainedNodes(getActiveRange(),isFormattableNode)[0];if(b===undefined){b=getActiveRange().startContainer}var a=getEffectiveCommandValue(b,"fontsize");return getLegacyFontSize(a)},relevantCssProperty:"fontSize"};function getLegacyFontSize(c){if(getLegacyFontSize.resultCache===undefined){getLegacyFontSize.resultCache={}}if(getLegacyFontSize.resultCache[c]!==undefined){return getLegacyFontSize.resultCache[c]}if(normalizeFontSize(c)!==null){return getLegacyFontSize.resultCache[c]=cssSizeToLegacy(normalizeFontSize(c))}if(["xx-small","x-small","small","medium","large","x-large","xx-large","xxx-large"].indexOf(c)==-1&&!/^[0-9]+(\.[0-9]+)?(cm|mm|in|pt|pc|px)$/.test(c)){return getLegacyFontSize.resultCache[c]=null}var b=document.createElement("font");document.body.appendChild(b);if(c=="xxx-large"){b.size=7}else{b.style.fontSize=c}var a=parseInt(getComputedStyle(b).fontSize);document.body.removeChild(b);var e=1;while(e<7){var b=document.createElement("font");b.size=e;document.body.appendChild(b);var g=parseInt(getComputedStyle(b).fontSize);b.size=1+e;var f=parseInt(getComputedStyle(b).fontSize);document.body.removeChild(b);var d=(f+g)/2;if(a<d){return getLegacyFontSize.resultCache[c]=String(e)}e++}return getLegacyFontSize.resultCache[c]="7"}commands.forecolor={action:function(a){if(/^([0-9a-fA-F]{3}){1,2}$/.test(a)){a="#"+a}if(!/^(rgba?|hsla?)\(.*\)$/.test(a)&&!parseSimpleColor(a)&&a.toLowerCase()!="transparent"){return}setSelectionValue("forecolor",a)},standardInlineValueCommand:true,relevantCssProperty:"color",equivalentValues:function(b,a){return normalizeColor(b)===normalizeColor(a)},};commands.hilitecolor={action:function(a){if(/^([0-9a-fA-F]{3}){1,2}$/.test(a)){a="#"+a}if(!/^(rgba?|hsla?)\(.*\)$/.test(a)&&!parseSimpleColor(a)&&a.toLowerCase()!="transparent"){return}setSelectionValue("hilitecolor",a)},indeterm:function(){return getAllEffectivelyContainedNodes(getActiveRange(),function(a){return isEditable(a)&&a.nodeType==Node.TEXT_NODE}).map(function(a){return getEffectiveCommandValue(a,"hilitecolor")}).filter(function(c,b,a){return a.slice(0,b).indexOf(c)==-1}).length>=2},standardInlineValueCommand:true,relevantCssProperty:"backgroundColor",equivalentValues:function(b,a){return normalizeColor(b)===normalizeColor(a)},};commands.italic={action:function(){if(myQueryCommandState("italic")){setSelectionValue("italic","normal")}else{setSelectionValue("italic","italic")}},inlineCommandActivatedValues:["italic","oblique"],relevantCssProperty:"fontStyle"};commands.removeformat={action:function(){function e(f){return isEditable(f)&&isHtmlElement(f,["abbr","acronym","b","bdi","bdo","big","blink","cite","code","dfn","em","font","i","ins","kbd","mark","nobr","q","s","samp","small","span","strike","strong","sub","sup","tt","u","var"])}var c=getAllEffectivelyContainedNodes(getActiveRange(),e);c.forEach(function(f){while(f.hasChildNodes()){movePreservingRanges(f.firstChild,f.parentNode,getNodeIndex(f))}f.parentNode.removeChild(f)});if(isEditable(getActiveRange().startContainer)&&getActiveRange().startContainer.nodeType==Node.TEXT_NODE&&getActiveRange().startOffset!=0&&getActiveRange().startOffset!=getNodeLength(getActiveRange().startContainer)){if(getActiveRange().startContainer==getActiveRange().endContainer){var d=getActiveRange().endOffset-getActiveRange().startOffset;var b=getActiveRange().startContainer.splitText(getActiveRange().startOffset);getActiveRange().setStart(b,0);getActiveRange().setEnd(b,d)}else{getActiveRange().setStart(getActiveRange().startContainer.splitText(getActiveRange().startOffset),0)}}if(isEditable(getActiveRange().endContainer)&&getActiveRange().endContainer.nodeType==Node.TEXT_NODE&&getActiveRange().endOffset!=0&&getActiveRange().endOffset!=getNodeLength(getActiveRange().endContainer)){var a=[getActiveRange().startContainer,getActiveRange().startOffset];var d=[getActiveRange().endContainer,getActiveRange().endOffset];getActiveRange().setEnd(document.documentElement,0);d[0].splitText(d[1]);getActiveRange().setStart(a[0],a[1]);getActiveRange().setEnd(d[0],d[1])}getAllEffectivelyContainedNodes(getActiveRange(),isEditable).forEach(function(f){while(e(f.parentNode)&&inSameEditingHost(f.parentNode,f)){splitParent([f])}});["subscript","bold","fontname","fontsize","forecolor","hilitecolor","italic","strikethrough","underline",].forEach(function(f){setSelectionValue(f,null)})}};commands.strikethrough={action:function(){if(myQueryCommandState("strikethrough")){setSelectionValue("strikethrough",null)}else{setSelectionValue("strikethrough","line-through")}},inlineCommandActivatedValues:["line-through"]};commands.subscript={action:function(){var a=myQueryCommandState("subscript");setSelectionValue("subscript",null);if(!a){setSelectionValue("subscript","subscript")}},indeterm:function(){var a=getAllEffectivelyContainedNodes(getActiveRange(),isFormattableNode);return(a.some(function(b){return getEffectiveCommandValue(b,"subscript")=="subscript"})&&a.some(function(b){return getEffectiveCommandValue(b,"subscript")!="subscript"}))||a.some(function(b){return getEffectiveCommandValue(b,"subscript")=="mixed"})},inlineCommandActivatedValues:["subscript"],};commands.superscript={action:function(){var a=myQueryCommandState("superscript");setSelectionValue("superscript",null);if(!a){setSelectionValue("superscript","superscript")}},indeterm:function(){var a=getAllEffectivelyContainedNodes(getActiveRange(),isFormattableNode);return(a.some(function(b){return getEffectiveCommandValue(b,"superscript")=="superscript"})&&a.some(function(b){return getEffectiveCommandValue(b,"superscript")!="superscript"}))||a.some(function(b){return getEffectiveCommandValue(b,"superscript")=="mixed"})},inlineCommandActivatedValues:["superscript"],};commands.underline={action:function(){if(myQueryCommandState("underline")){setSelectionValue("underline",null)}else{setSelectionValue("underline","underline")}},inlineCommandActivatedValues:["underline"]};commands.unlink={action:function(){var a=getActiveRange();var b=[];for(var d=a.startContainer;d;d=d.parentNode){if(isHtmlElement(d,"A")&&d.hasAttribute("href")){b.unshift(d)}}for(var d=a.startContainer;d!=nextNodeDescendants(a.endContainer);d=nextNode(d)){if(isHtmlElement(d,"A")&&d.hasAttribute("href")&&(isContained(d,a)||isAncestor(d,a.endContainer)||d==a.endContainer)){b.push(d)}}for(var c=0;c<b.length;c++){clearValue(b[c],"unlink")}}};function isIndentationElement(b){if(!isHtmlElement(b)){return false}if(b.tagName=="BLOCKQUOTE"){return true}if(b.tagName!="DIV"){return false}for(var a=0;a<b.style.length;a++){if(/^(-[a-z]+-)?margin/.test(b.style[a])){return true}}return false}function isSimpleIndentationElement(b){if(!isIndentationElement(b)){return false}for(var a=0;a<b.attributes.length;a++){if(!isHtmlNamespace(b.attributes[a].namespaceURI)||["style","dir"].indexOf(b.attributes[a].name)==-1){return false}}for(var a=0;a<b.style.length;a++){if(!/^(-[a-z]+-)?(margin|border|padding)/.test(b.style[a])){return false}}return true}function isNonListSingleLineContainer(a){return isHtmlElement(a,["address","div","h1","h2","h3","h4","h5","h6","listing","p","pre","xmp"])}function isSingleLineContainer(a){return isNonListSingleLineContainer(a)||isHtmlElement(a,["li","dt","dd"])}function getBlockNodeOf(a){while(isInlineNode(a)){a=a.parentNode}return a}function fixDisallowedAncestors(c){if(!isEditable(c)){return}if(getAncestors(c).every(function(d){return !inSameEditingHost(c,d)||!isAllowedChild(c,d)})){if(isHtmlElement(c,["dd","dt"])){wrap([c],function(d){return isHtmlElement(d,"dl")&&!d.attributes.length},function(){return document.createElement("dl")});return}if(!isAllowedChild("p",getEditingHostOf(c))){return}if(!isProhibitedParagraphChild(c)){return}c=setTagName(c,defaultSingleLineContainerName);fixDisallowedAncestors(c);var b=[].slice.call(c.childNodes);b.filter(isProhibitedParagraphChild).forEach(function(e){var d=recordValues([e]);splitParent([e]);restoreValues(d)});return}var a=recordValues([c]);while(!isAllowedChild(c,c.parentNode)){splitParent([c])}restoreValues(a)}function normalizeSublists(b){if(!isHtmlElement(b,"LI")||!isEditable(b)||!isEditable(b.parentNode)){return}var a=null;while([].some.call(b.childNodes,function(d){return isHtmlElement(d,["OL","UL"])})){var c=b.lastChild;if(isHtmlElement(c,["OL","UL"])||(!a&&c.nodeType==Node.TEXT_NODE&&/^[ \t\n\f\r]*$/.test(c.data))){a=null;movePreservingRanges(c,b.parentNode,1+getNodeIndex(b))}else{if(!a){a=b.ownerDocument.createElement("li");b.parentNode.insertBefore(a,b.nextSibling)}movePreservingRanges(c,a,0)}}}function getSelectionListState(){if(!getActiveRange()){return"none"}var c=blockExtend(getActiveRange());var b=getContainedNodes(c,function(e){return isEditable(e)&&!isIndentationElement(e)&&(isHtmlElement(e,["ol","ul"])||isHtmlElement(e.parentNode,["ol","ul"])||isAllowedChild(e,"li"))});if(!b.length){return"none"}if(b.every(function(e){return isHtmlElement(e,"ol")||isHtmlElement(e.parentNode,"ol")||(isHtmlElement(e.parentNode,"li")&&isHtmlElement(e.parentNode.parentNode,"ol"))})&&!b.some(function(e){return isHtmlElement(e,"ul")||("querySelector" in e&&e.querySelector("ul"))})){return"ol"}if(b.every(function(e){return isHtmlElement(e,"ul")||isHtmlElement(e.parentNode,"ul")||(isHtmlElement(e.parentNode,"li")&&isHtmlElement(e.parentNode.parentNode,"ul"))})&&!b.some(function(e){return isHtmlElement(e,"ol")||("querySelector" in e&&e.querySelector("ol"))})){return"ul"}var d=b.some(function(e){return isHtmlElement(e,"ol")||isHtmlElement(e.parentNode,"ol")||("querySelector" in e&&e.querySelector("ol"))||(isHtmlElement(e.parentNode,"li")&&isHtmlElement(e.parentNode.parentNode,"ol"))});var a=b.some(function(e){return isHtmlElement(e,"ul")||isHtmlElement(e.parentNode,"ul")||("querySelector" in e&&e.querySelector("ul"))||(isHtmlElement(e.parentNode,"li")&&isHtmlElement(e.parentNode.parentNode,"ul"))});if(d&&a){return"mixed"}if(d){return"mixed ol"}if(a){return"mixed ul"}return"none"}function getAlignmentValue(b){while((b&&b.nodeType!=Node.ELEMENT_NODE)||(b.nodeType==Node.ELEMENT_NODE&&["inline","none"].indexOf(getComputedStyle(b).display)!=-1)){b=b.parentNode}if(!b||b.nodeType!=Node.ELEMENT_NODE){return"left"}var a=getComputedStyle(b).textAlign.replace(/^-(moz|webkit)-/,"").replace(/^auto$/,"start");if(a=="start"){return getDirectionality(b)=="ltr"?"left":"right"}if(a=="end"){return getDirectionality(b)=="ltr"?"right":"left"}if(["center","justify","left","right"].indexOf(a)!=-1){return a}return"left"}function getNextEquivalentPoint(a,b){if(getNodeLength(a)==0){return null}if(b==getNodeLength(a)&&a.parentNode&&isInlineNode(a)){return[a.parentNode,1+getNodeIndex(a)]}if(0<=b&&b<a.childNodes.length&&getNodeLength(a.childNodes[b])!=0&&isInlineNode(a.childNodes[b])){return[a.childNodes[b],0]}return null}function getPreviousEquivalentPoint(a,b){if(getNodeLength(a)==0){return null}if(b==0&&a.parentNode&&isInlineNode(a)){return[a.parentNode,getNodeIndex(a)]}if(0<=b-1&&b-1<a.childNodes.length&&getNodeLength(a.childNodes[b-1])!=0&&isInlineNode(a.childNodes[b-1])){return[a.childNodes[b-1],getNodeLength(a.childNodes[b-1])]}return null}function getFirstEquivalentPoint(b,c){var a;while(a=getPreviousEquivalentPoint(b,c)){b=a[0];c=a[1]}return[b,c]}function getLastEquivalentPoint(b,c){var a;while(a=getNextEquivalentPoint(b,c)){b=a[0];c=a[1]}return[b,c]}function isBlockStartPoint(a,b){return(!a.parentNode&&b==0)||(0<=b-1&&b-1<a.childNodes.length&&isVisible(a.childNodes[b-1])&&(isBlockNode(a.childNodes[b-1])||isHtmlElement(a.childNodes[b-1],"br")))}function isBlockEndPoint(a,b){return(!a.parentNode&&b==getNodeLength(a))||(b<a.childNodes.length&&isVisible(a.childNodes[b])&&isBlockNode(a.childNodes[b]))}function isBlockBoundaryPoint(a,b){return isBlockStartPoint(a,b)||isBlockEndPoint(a,b)}function blockExtend(c){var f=c.startContainer;var b=c.startOffset;var a=c.endContainer;var e=c.endOffset;var g=getAncestors(f).concat(f).filter(function(h){return isHtmlElement(h,"li")}).slice(-1);if(g.length){b=getNodeIndex(g[0]);f=g[0].parentNode}if(!isBlockStartPoint(f,b)){do{if(b==0){b=getNodeIndex(f);f=f.parentNode}else{b--}}while(!isBlockBoundaryPoint(f,b))}while(b==0&&f.parentNode){b=getNodeIndex(f);f=f.parentNode}var g=getAncestors(a).concat(a).filter(function(h){return isHtmlElement(h,"li")}).slice(-1);if(g.length){e=1+getNodeIndex(g[0]);a=g[0].parentNode}if(!isBlockEndPoint(a,e)){do{if(e==getNodeLength(a)){e=1+getNodeIndex(a);a=a.parentNode}else{e++}}while(!isBlockBoundaryPoint(a,e))}while(e==getNodeLength(a)&&a.parentNode){e=1+getNodeIndex(a);a=a.parentNode}var d=f.ownerDocument.createRange();d.setStart(f,b);d.setEnd(a,e);return d}function followsLineBreak(a){var b=0;while(!isBlockBoundaryPoint(a,b)){if(0<=b-1&&b-1<a.childNodes.length&&isVisible(a.childNodes[b-1])){return false}if(b==0||!a.hasChildNodes()){b=getNodeIndex(a);a=a.parentNode}else{a=a.childNodes[b-1];b=getNodeLength(a)}}return true}function precedesLineBreak(a){var b=getNodeLength(a);while(!isBlockBoundaryPoint(a,b)){if(b<a.childNodes.length&&isVisible(a.childNodes[b])){return false}if(b==getNodeLength(a)||!a.hasChildNodes()){b=1+getNodeIndex(a);a=a.parentNode}else{a=a.childNodes[b];b=0}}return true}function recordCurrentOverrides(){var a=[];if(getValueOverride("createlink")!==undefined){a.push(["createlink",getValueOverride("createlink")])}["bold","italic","strikethrough","subscript","superscript","underline"].forEach(function(b){if(getStateOverride(b)!==undefined){a.push([b,getStateOverride(b)])}});["fontname","fontsize","forecolor","hilitecolor"].forEach(function(b){if(getValueOverride(b)!==undefined){a.push([b,getValueOverride(b)])}});return a}function recordCurrentStatesAndValues(){var b=[];var a=getAllEffectivelyContainedNodes(getActiveRange()).filter(isFormattableNode)[0];if(!a){return b}b.push(["createlink",getEffectiveCommandValue(a,"createlink")]);["bold","italic","strikethrough","subscript","superscript","underline"].forEach(function(c){if(commands[c].inlineCommandActivatedValues.indexOf(getEffectiveCommandValue(a,c))!=-1){b.push([c,true])}else{b.push([c,false])}});["fontname","fontsize","forecolor","hilitecolor"].forEach(function(c){b.push([c,commands[c].value()])});b.push(["fontsize",getEffectiveCommandValue(a,"fontsize")]);return b}function restoreStatesAndValues(e){var c=getAllEffectivelyContainedNodes(getActiveRange()).filter(isFormattableNode)[0];if(c){for(var b=0;b<e.length;b++){var d=e[b][0];var a=e[b][1];if(typeof a=="boolean"&&myQueryCommandState(d)!=a){commands[d].action("")}else{if(typeof a=="string"&&d!="createlink"&&d!="fontsize"&&!areEquivalentValues(d,myQueryCommandValue(d),a)){commands[d].action(a)}else{if(typeof a=="string"&&d=="createlink"&&((getValueOverride("createlink")!==undefined&&getValueOverride("createlink")!==a)||(getValueOverride("createlink")===undefined&&getEffectiveCommandValue(c,"createlink")!==a))){commands.createlink.action(a)}else{if(typeof a=="string"&&d=="fontsize"&&((getValueOverride("fontsize")!==undefined&&getValueOverride("fontsize")!==a)||(getValueOverride("fontsize")===undefined&&!areLooselyEquivalentValues(d,getEffectiveCommandValue(c,"fontsize"),a)))){a=getLegacyFontSize(a);commands.fontsize.action(a)}else{continue}}}}c=getAllEffectivelyContainedNodes(getActiveRange()).filter(isFormattableNode)[0]||c}}else{for(var b=0;b<e.length;b++){var d=e[b][0];var a=e[b][1];if(typeof a=="boolean"){setStateOverride(d,a)}if(typeof a=="string"){setValueOverride(d,a)}}}}function deleteSelection(k){if(k===undefined){k={}}var m="blockMerging" in k?Boolean(k.blockMerging):true;var t="stripWrappers" in k?Boolean(k.stripWrappers):true;var w="direction" in k?k.direction:"forward";if(!getActiveRange()){return}canonicalizeWhitespace(getActiveRange().startContainer,getActiveRange().startOffset);canonicalizeWhitespace(getActiveRange().endContainer,getActiveRange().endOffset);var g=getLastEquivalentPoint(getActiveRange().startContainer,getActiveRange().startOffset);var x=g[0];var r=g[1];var d=getFirstEquivalentPoint(getActiveRange().endContainer,getActiveRange().endOffset);var p=d[0];var h=d[1];if(getPosition(p,h,x,r)!=="after"){if(w=="forward"){if(getSelection().rangeCount){getSelection().collapseToStart()}getActiveRange().collapse(true)}else{getSelection().collapseToEnd();getActiveRange().collapse(false)}return}if(x.nodeType==Node.TEXT_NODE&&r==0){r=getNodeIndex(x);x=x.parentNode}if(p.nodeType==Node.TEXT_NODE&&h==getNodeLength(p)){h=1+getNodeIndex(p);p=p.parentNode}getSelection().collapse(x,r);getActiveRange().setStart(x,r);getSelection().extend(p,h);getActiveRange().setEnd(p,h);var j=getActiveRange().startContainer;while(inSameEditingHost(j,j.parentNode)&&isInlineNode(j)){j=j.parentNode}if((!isBlockNode(j)&&!isEditingHost(j))||!isAllowedChild("span",j)||isHtmlElement(j,["td","th"])){j=null}var e=getActiveRange().endContainer;while(inSameEditingHost(e,e.parentNode)&&isInlineNode(e)){e=e.parentNode}if((!isBlockNode(e)&&!isEditingHost(e))||!isAllowedChild("span",e)||isHtmlElement(e,["td","th"])){e=null}var n=recordCurrentStatesAndValues();if(x==p&&isEditable(x)&&x.nodeType==Node.TEXT_NODE){x.deleteData(r,h-r);canonicalizeWhitespace(x,r,false);if(w=="forward"){if(getSelection().rangeCount){getSelection().collapseToStart()}getActiveRange().collapse(true)}else{getSelection().collapseToEnd();getActiveRange().collapse(false)}restoreStatesAndValues(n);return}if(isEditable(x)&&x.nodeType==Node.TEXT_NODE){x.deleteData(r,getNodeLength(x)-r)}var u=getContainedNodes(getActiveRange(),function(i){return isEditable(i)&&!isHtmlElement(i,["thead","tbody","tfoot","tr","th","td"])});for(var s=0;s<u.length;s++){var q=u[s];var l=q.parentNode;l.removeChild(q);if(![].some.call(getBlockNodeOf(l).childNodes,isVisible)&&(isEditable(l)||isEditingHost(l))){l.appendChild(document.createElement("br"))}if(t||(!isAncestor(l,x)&&l!=x)){while(isEditable(l)&&isInlineNode(l)&&getNodeLength(l)==0){var a=l.parentNode;a.removeChild(l);l=a}}}if(isEditable(p)&&p.nodeType==Node.TEXT_NODE){p.deleteData(0,h)}canonicalizeWhitespace(getActiveRange().startContainer,getActiveRange().startOffset,false);canonicalizeWhitespace(getActiveRange().endContainer,getActiveRange().endOffset,false);if(!m||!j||!e||!inSameEditingHost(j,e)||j==e){if(w=="forward"){if(getSelection().rangeCount){getSelection().collapseToStart()}getActiveRange().collapse(true)}else{if(getSelection().rangeCount){getSelection().collapseToEnd()}getActiveRange().collapse(false)}restoreStatesAndValues(n);return}if(j.children.length==1&&isCollapsedBlockProp(j.firstChild)){j.removeChild(j.firstChild)}if(isAncestor(j,e)){var o=e;while(o.parentNode!=j){o=o.parentNode}getSelection().collapse(j,getNodeIndex(o));getActiveRange().setStart(j,getNodeIndex(o));getActiveRange().collapse(true);if(!e.hasChildNodes()){while(isEditable(e)&&e.parentNode.childNodes.length==1&&e.parentNode!=j){var l=e;l.removeChild(e);e=l}if(isEditable(e)&&!isInlineNode(e)&&isInlineNode(e.previousSibling)&&isInlineNode(e.nextSibling)){e.parentNode.insertBefore(document.createElement("br"),e.nextSibling)}if(isEditable(e)){e.parentNode.removeChild(e)}restoreStatesAndValues(n);return}if(!isInlineNode(e.firstChild)){restoreStatesAndValues(n);return}var f=[];f.push(e.firstChild);while(!isHtmlElement(f[f.length-1],"br")&&isInlineNode(f[f.length-1].nextSibling)){f.push(f[f.length-1].nextSibling)}var b=recordValues(f);while(f[0].parentNode!=j){splitParent(f)}if(isEditable(f[0].previousSibling)&&isHtmlElement(f[0].previousSibling,"br")){f[0].parentNode.removeChild(f[0].previousSibling)}}else{if(isDescendant(j,e)){getSelection().collapse(j,getNodeLength(j));getActiveRange().setStart(j,getNodeLength(j));getActiveRange().collapse(true);var o=j;while(o.parentNode!=e){o=o.parentNode}if(isInlineNode(o.nextSibling)&&isHtmlElement(j.lastChild,"br")){j.removeChild(j.lastChild)}var c=[];if(o.nextSibling&&!isBlockNode(o.nextSibling)){c.push(o.nextSibling)}if(c.length&&!isHtmlElement(c[c.length-1],"br")&&c[c.length-1].nextSibling&&!isBlockNode(c[c.length-1].nextSibling)){c.push(c[c.length-1].nextSibling)}var b=recordValues(c);c.forEach(function(i){movePreservingRanges(i,j,-1)})}else{getSelection().collapse(j,getNodeLength(j));getActiveRange().setStart(j,getNodeLength(j));getActiveRange().collapse(true);if(isInlineNode(e.firstChild)&&isHtmlElement(j.lastChild,"br")){j.removeChild(j.lastChild)}var b=recordValues([].slice.call(e.childNodes));while(e.hasChildNodes()){movePreservingRanges(e.firstChild,j,-1)}while(!e.hasChildNodes()){var l=e.parentNode;l.removeChild(e);e=l}}}var v=j;while(getInclusiveAncestors(v).some(function(i){return inSameEditingHost(v,i)&&((isHtmlElement(i,"ol")&&isHtmlElement(i.nextSibling,"ol"))||(isHtmlElement(i,"ul")&&isHtmlElement(i.nextSibling,"ul")))&&inSameEditingHost(v,i.nextSibling)})){while(!(isHtmlElement(v,"ol")&&isHtmlElement(v.nextSibling,"ol")&&inSameEditingHost(v,v.nextSibling))&&!(isHtmlElement(v,"ul")&&isHtmlElement(v.nextSibling,"ul")&&inSameEditingHost(v,v.nextSibling))){v=v.parentNode}while(v.nextSibling.hasChildNodes()){movePreservingRanges(v.nextSibling.firstChild,v,-1)}v.parentNode.removeChild(v.nextSibling)}restoreValues(b);if(!j.hasChildNodes()){j.appendChild(document.createElement("br"))}removeExtraneousLineBreaksAtTheEndOf(j);restoreStatesAndValues(n)}function splitParent(b){var a=b[0].parentNode;if(!isEditable(a)||!a.parentNode){return}if(b.indexOf(a.firstChild)!=-1){removeExtraneousLineBreaksBefore(a)}var e=b.indexOf(a.firstChild)!=-1&&followsLineBreak(a);var f=b.indexOf(a.lastChild)!=-1&&precedesLineBreak(a);if(b.indexOf(a.firstChild)==-1&&b.indexOf(a.lastChild)!=-1){for(var c=b.length-1;c>=0;c--){movePreservingRanges(b[c],a.parentNode,1+getNodeIndex(a))}if(f&&!precedesLineBreak(b[b.length-1])){b[b.length-1].parentNode.insertBefore(document.createElement("br"),b[b.length-1].nextSibling)}removeExtraneousLineBreaksAtTheEndOf(a);return}if(b.indexOf(a.firstChild)==-1){var d=a.cloneNode(false);a.removeAttribute("id");a.parentNode.insertBefore(d,a);while(b[0].previousSibling){movePreservingRanges(a.firstChild,d,d.childNodes.length)}}for(var c=0;c<b.length;c++){movePreservingRanges(b[c],a.parentNode,getNodeIndex(a))}if(e&&!followsLineBreak(b[0])){b[0].parentNode.insertBefore(document.createElement("br"),b[0])}if(isInlineNode(b[b.length-1])&&!isHtmlElement(b[b.length-1],"br")&&isHtmlElement(a.firstChild,"br")&&!isInlineNode(a)){a.removeChild(a.firstChild)}if(!a.hasChildNodes()){a.parentNode.removeChild(a);if(f&&!precedesLineBreak(b[b.length-1])){b[b.length-1].parentNode.insertBefore(document.createElement("br"),b[b.length-1].nextSibling)}}else{removeExtraneousLineBreaksBefore(a)}if(!b[b.length-1].nextSibling&&b[b.length-1].parentNode){removeExtraneousLineBreaksAtTheEndOf(b[b.length-1].parentNode)}}function removePreservingDescendants(a){if(a.hasChildNodes()){splitParent([].slice.call(a.childNodes))}else{a.parentNode.removeChild(a)}}function canonicalSpaceSequence(e,c,a){if(e==0){return""}if(e==1&&!c&&!a){return" "}if(e==1){return"\xa0"}var b="";var d;if(c){d="\xa0 "}else{d=" \xa0"}while(e>3){b+=d;e-=2}if(e==3){b+=!c&&!a?" \xa0 ":c&&!a?"\xa0\xa0 ":!c&&a?" \xa0\xa0":c&&a?"\xa0 \xa0":"impossible"}else{b+=!c&&!a?"\xa0 ":c&&!a?"\xa0 ":!c&&a?" \xa0":c&&a?"\xa0\xa0":"impossible"}return b}function canonicalizeWhitespace(e,f,d){if(d===undefined){d=true}if(!isEditable(e)&&!isEditingHost(e)){return}var c=e;var i=f;while(true){if(0<=i-1&&inSameEditingHost(c,c.childNodes[i-1])){c=c.childNodes[i-1];i=getNodeLength(c)}else{if(i==0&&!followsLineBreak(c)&&inSameEditingHost(c,c.parentNode)){i=getNodeIndex(c);c=c.parentNode}else{if(c.nodeType==Node.TEXT_NODE&&["pre","pre-wrap"].indexOf(getComputedStyle(c.parentNode).whiteSpace)==-1&&i!=0&&/[ \xa0]/.test(c.data[i-1])){i--}else{break}}}}var h=c;var j=i;var b=0;var a=i==0&&followsLineBreak(c);while(true){if(j<h.childNodes.length&&inSameEditingHost(h,h.childNodes[j])){h=h.childNodes[j];j=0}else{if(j==getNodeLength(h)&&!precedesLineBreak(h)&&inSameEditingHost(h,h.parentNode)){j=1+getNodeIndex(h);h=h.parentNode}else{if(h.nodeType==Node.TEXT_NODE&&["pre","pre-wrap"].indexOf(getComputedStyle(h.parentNode).whiteSpace)==-1&&j!=getNodeLength(h)&&/[ \xa0]/.test(h.data[j])){if(d&&a&&" "==h.data[j]){h.deleteData(j,1);continue}a=" "==h.data[j];j++;b++}else{break}}}}if(d){while(getPosition(c,i,h,j)=="before"){if(0<=j-1&&j-1<h.childNodes.length&&inSameEditingHost(h,h.childNodes[j-1])){h=h.childNodes[j-1];j=getNodeLength(h)}else{if(j==0&&inSameEditingHost(h,h.parentNode)){j=getNodeIndex(h);h=h.parentNode}else{if(h.nodeType==Node.TEXT_NODE&&["pre","pre-wrap"].indexOf(getComputedStyle(h.parentNode).whiteSpace)==-1&&j==getNodeLength(h)&&h.data[h.data.length-1]==" "&&precedesLineBreak(h)){j--;b--;h.deleteData(j,1)}else{break}}}}}var k=canonicalSpaceSequence(b,i==0&&followsLineBreak(c),j==getNodeLength(h)&&precedesLineBreak(h));while(getPosition(c,i,h,j)=="before"){if(i<c.childNodes.length){c=c.childNodes[i];i=0}else{if(c.nodeType!=Node.TEXT_NODE||i==getNodeLength(c)){i=1+getNodeIndex(c);c=c.parentNode}else{var g=k[0];k=k.slice(1);if(g!=c.data[i]){c.insertData(i,g);c.deleteData(i+1,1)}i++}}}}function indentNodes(b){if(!b.length){return}var d=b[0];if(isHtmlElement(d.parentNode,["OL","UL"])){var a=d.parentNode.tagName;wrap(b,function(e){return isHtmlElement(e,a)},function(){return d.ownerDocument.createElement(a)});return}var c=wrap(b,function(e){return isSimpleIndentationElement(e)},function(){return d.ownerDocument.createElement("blockquote")});fixDisallowedAncestors(c)}function outdentNode(b){if(!isEditable(b)){return}if(isSimpleIndentationElement(b)){removePreservingDescendants(b);return}if(isIndentationElement(b)){b.removeAttribute("dir");b.style.margin="";b.style.padding="";b.style.border="";if(b.getAttribute("style")==""||b.getAttribute("style")=="border-width: initial; border-color: initial; "){b.removeAttribute("style")}setTagName(b,"div");return}var c=b.parentNode;var j=[];while(isEditable(c)&&c.nodeType==Node.ELEMENT_NODE&&!isSimpleIndentationElement(c)&&!isHtmlElement(c,["ol","ul"])){j.push(c);c=c.parentNode}if(!isEditable(c)||!isSimpleIndentationElement(c)){c=b.parentNode;j=[];while(isEditable(c)&&c.nodeType==Node.ELEMENT_NODE&&!isIndentationElement(c)&&!isHtmlElement(c,["ol","ul"])){j.push(c);c=c.parentNode}}if(isHtmlElement(b,["OL","UL"])&&(!isEditable(c)||!isIndentationElement(c))){b.removeAttribute("reversed");b.removeAttribute("start");b.removeAttribute("type");var a=[].slice.call(b.childNodes);if(b.attributes.length&&!isHtmlElement(b.parentNode,["OL","UL"])){setTagName(b,"div")}else{var k=recordValues([].slice.call(b.childNodes));removePreservingDescendants(b);restoreValues(k)}for(var d=0;d<a.length;d++){fixDisallowedAncestors(a[d])}return}if(!isEditable(c)||!isIndentationElement(c)){return}j.push(c);var f=c;while(j.length){c=j.pop();var g=b.parentNode==c?b:j[j.length-1];if(isInlineNode(g)&&!isHtmlElement(g,"BR")&&isHtmlElement(g.nextSibling,"BR")){g.parentNode.removeChild(g.nextSibling)}var h=[].slice.call(c.childNodes,0,getNodeIndex(g));var e=[].slice.call(c.childNodes,1+getNodeIndex(g));indentNodes(h);indentNodes(e)}outdentNode(f)}function toggleLists(a){var l=recordCurrentOverrides();var f=getSelectionListState()==a?"disable":"enable";var e=getActiveRange();a=a.toUpperCase();var g=a=="OL"?"UL":"OL";var h=[];(function(){for(var i=e.endContainer;i!=e.commonAncestorContainer;i=i.parentNode){if(isHtmlElement(i,"li")){h.unshift(i)}}for(var i=e.startContainer;i;i=i.parentNode){if(isHtmlElement(i,"li")){h.unshift(i)}}})();h.forEach(normalizeSublists);var j=blockExtend(e);if(f=="enable"){getAllContainedNodes(j,function(i){return isEditable(i)&&isHtmlElement(i,g)}).forEach(function(o){if((isEditable(o.previousSibling)&&isHtmlElement(o.previousSibling,a))||(isEditable(o.nextSibling)&&isHtmlElement(o.nextSibling,a))){var n=[].slice.call(o.childNodes);var i=recordValues(n);splitParent(n);wrap(n,function(p){return isHtmlElement(p,a)});restoreValues(i)}else{setTagName(o,a)}})}var b=getContainedNodes(j,function(i){return isEditable(i)&&!isIndentationElement(i)&&(isHtmlElement(i,["OL","UL"])||isHtmlElement(i.parentNode,["OL","UL"])||isAllowedChild(i,"li"))});if(f=="enable"){b=b.filter(function(i){return !isHtmlElement(i,["ol","ul"])||isHtmlElement(i.parentNode,["ol","ul"])})}if(f=="disable"){while(b.length){var d=[];d.push(b.shift());if(isHtmlElement(d[0],a)){outdentNode(d[0]);continue}while(b.length&&b[0]==d[d.length-1].nextSibling&&!isHtmlElement(b[0],a)){d.push(b.shift())}var k=recordValues(d);splitParent(d);for(var c=0;c<d.length;c++){fixDisallowedAncestors(d[c])}restoreValues(k)}}else{while(b.length){var d=[];while(!d.length||(b.length&&b[0]==d[d.length-1].nextSibling)){if(isHtmlElement(b[0],["p","div"])){d.push(setTagName(b[0],"li"));b.shift()}else{if(isHtmlElement(b[0],["li","ol","ul"])){d.push(b.shift())}else{var m=[];while(!m.length||(b.length&&b[0]==m[m.length-1].nextSibling&&isInlineNode(b[0])&&isInlineNode(m[m.length-1])&&!isHtmlElement(m[m.length-1],"br"))){m.push(b.shift())}d.push(wrap(m,undefined,function(){return document.createElement("li")}))}}}if(isHtmlElement(d[0].parentNode,a)||d.every(function(i){return isHtmlElement(i,["ol","ul"])})){continue}if(isHtmlElement(d[0].parentNode,g)){var k=recordValues(d);splitParent(d);wrap(d,function(i){return isHtmlElement(i,a)},function(){return document.createElement(a)});restoreValues(k);continue}fixDisallowedAncestors(wrap(d,function(i){return isHtmlElement(i,a)},function(){if(!isEditable(d[0].parentNode)||!isSimpleIndentationElement(d[0].parentNode)||!isEditable(d[0].parentNode.previousSibling)||!isHtmlElement(d[0].parentNode.previousSibling,a)){return document.createElement(a)}var i=d[0].parentNode.previousSibling;normalizeSublists(i.lastChild);if(!isEditable(i.lastChild)||!isHtmlElement(i.lastChild,a)){i.appendChild(document.createElement(a))}return i.lastChild}))}}restoreStatesAndValues(l)}function justifySelection(h){var g=recordCurrentOverrides();var c=blockExtend(globalRange);var f=getAllContainedNodes(c,function(i){return i.nodeType==Node.ELEMENT_NODE&&isEditable(i)&&(i.hasAttribute("align")||i.style.textAlign!=""||isHtmlElement(i,"center"))});for(var e=0;e<f.length;e++){var d=f[e];d.removeAttribute("align");d.style.textAlign="";if(d.getAttribute("style")==""){d.removeAttribute("style")}if(isHtmlElement(d,["div","span","center"])&&!d.attributes.length){removePreservingDescendants(d)}if(isHtmlElement(d,"center")&&d.attributes.length){setTagName(d,"div")}}c=blockExtend(globalRange);var b=[];b=getContainedNodes(c,function(i){return isEditable(i)&&isAllowedChild(i,"div")&&getAlignmentValue(i)!=h});while(b.length){var a=[];a.push(b.shift());while(b.length&&b[0]==a[a.length-1].nextSibling){a.push(b.shift())}wrap(a,function(i){return isHtmlElement(i,"div")&&[].every.call(i.attributes,function(j){return(j.name=="align"&&j.value.toLowerCase()==h)||(j.name=="style"&&i.style.length==1&&i.style.textAlign==h)})},function(){var i=document.createElement("div");i.setAttribute("style","text-align: "+h);return i})}restoreStatesAndValues(g)}var autolinkableUrlRegexp="([a-zA-Z][a-zA-Z0-9+.-]*://|mailto:)[^ \t\n\f\r]*[^!\"'(),\\-.:;<>[\\]`{}]";var validEmailRegexp="[a-zA-Z0-9!#$%&'*+\\-/=?^_`{|}~.]+@[a-zA-Z0-9-]+(.[a-zA-Z0-9-]+)*";function autolink(g,d){while(getPreviousEquivalentPoint(g,d)){var f=getPreviousEquivalentPoint(g,d);g=f[0];d=f[1]}if(g.nodeType!=Node.TEXT_NODE||getAncestors(g).some(function(i){return isHtmlElement(i,"a")})){return}var e=/[^ \t\n\f\r]*$/.exec(g.substringData(0,d))[0];if(new RegExp(autolinkableUrlRegexp).test(e)){while(!(new RegExp(autolinkableUrlRegexp+"$").test(g.substringData(0,d)))){d--}var a=new RegExp(autolinkableUrlRegexp+"$").exec(g.substringData(0,d)).index;var b=g.substringData(a,d-a)}else{if(new RegExp(validEmailRegexp).test(e)){while(!(new RegExp(validEmailRegexp+"$").test(g.substringData(0,d)))){d--}var a=new RegExp(validEmailRegexp+"$").exec(g.substringData(0,d)).index;var b="mailto:"+g.substringData(a,d-a)}else{return}}var h=getActiveRange();var c=document.createRange();c.setStart(g,a);c.setEnd(g,d);getSelection().removeAllRanges();getSelection().addRange(c);globalRange=c;commands.createlink.action(b);getSelection().removeAllRanges();getSelection().addRange(h);globalRange=h}commands["delete"]={action:function(){if(!getActiveRange().collapsed){deleteSelection();return}canonicalizeWhitespace(getActiveRange().startContainer,getActiveRange().startOffset);var b=getActiveRange().startContainer;var d=getActiveRange().startOffset;while(true){if(d==0&&isEditable(b.previousSibling)&&isInvisible(b.previousSibling)){b.parentNode.removeChild(b.previousSibling)}else{if(0<=d-1&&d-1<b.childNodes.length&&isEditable(b.childNodes[d-1])&&isInvisible(b.childNodes[d-1])){b.removeChild(b.childNodes[d-1]);d--}else{if((d==0&&isInlineNode(b))||isInvisible(b)){d=getNodeIndex(b);b=b.parentNode}else{if(0<=d-1&&d-1<b.childNodes.length&&isEditable(b.childNodes[d-1])&&isHtmlElement(b.childNodes[d-1],"a")){removePreservingDescendants(b.childNodes[d-1]);return}else{if(0<=d-1&&d-1<b.childNodes.length&&!isBlockNode(b.childNodes[d-1])&&!isHtmlElement(b.childNodes[d-1],["br","img"])){b=b.childNodes[d-1];d=getNodeLength(b)}else{break}}}}}}if((b.nodeType==Node.TEXT_NODE&&d!=0)||(isBlockNode(b)&&0<=d-1&&d-1<b.childNodes.length&&isHtmlElement(b.childNodes[d-1],["br","hr","img"]))){getSelection().collapse(b,d);getActiveRange().setEnd(b,d);getSelection().extend(b,d-1);getActiveRange().setStart(b,d-1);deleteSelection();return}if(isInlineNode(b)){return}if(isHtmlElement(b,["li","dt","dd"])&&b==b.parentNode.firstChild&&d==0){var j=[];for(var h=b.parentNode;h;h=h.parentNode){if(isHtmlElement(h,"li")){j.unshift(h)}}for(var f=0;f<j.length;f++){normalizeSublists(j[f])}var m=recordValues([b]);splitParent([b]);restoreValues(m);if(isHtmlElement(b,["dd","dt"])&&getAncestors(b).every(function(i){return !inSameEditingHost(b,i)||!isAllowedChild(b,i)})){b=setTagName(b,defaultSingleLineContainerName)}fixDisallowedAncestors(b);return}var a=b;var k=d;while(true){if(k==0){k=getNodeIndex(a);a=a.parentNode}else{if(0<=k-1&&k-1<a.childNodes.length&&isEditable(a.childNodes[k-1])&&isInvisible(a.childNodes[k-1])){a.removeChild(a.childNodes[k-1]);k--}else{break}}}if(d==0&&getAncestors(b).concat(b).filter(function(i){return isEditable(i)&&inSameEditingHost(i,b)&&isIndentationElement(i)}).length){var l=document.createRange();l.setStart(b,0);l=blockExtend(l);var c=getContainedNodes(l,function(i){return isEditable(i)&&!hasEditableDescendants(i)});for(var f=0;f<c.length;f++){outdentNode(c[f])}return}if(isHtmlElement(a.childNodes[k],"table")){return}if(0<=k-1&&k-1<a.childNodes.length&&isHtmlElement(a.childNodes[k-1],"table")){getSelection().collapse(a,k-1);getActiveRange().setStart(a,k-1);getSelection().extend(a,k);getActiveRange().setEnd(a,k);return}if(d==0&&(isHtmlElement(a.childNodes[k-1],"hr")||(isHtmlElement(a.childNodes[k-1],"br")&&(isHtmlElement(a.childNodes[k-1].previousSibling,"br")||!isInlineNode(a.childNodes[k-1].previousSibling))))){getSelection().collapse(a,k-1);getActiveRange().setStart(a,k-1);getSelection().extend(a,k);getActiveRange().setEnd(a,k);deleteSelection();getSelection().collapse(b,d);getActiveRange().setStart(b,d);getActiveRange().collapse(true);return}if(isHtmlElement(a.childNodes[k],["li","dt","dd"])&&isInlineNode(a.childNodes[k].firstChild)&&k!=0){var e=a.childNodes[k-1];if(isInlineNode(e.lastChild)&&!isHtmlElement(e.lastChild,"br")){e.appendChild(document.createElement("br"))}if(isInlineNode(e.lastChild)){e.appendChild(document.createElement("br"))}}if(isHtmlElement(a.childNodes[k],["li","dt","dd"])&&isHtmlElement(a.childNodes[k].previousSibling,["li","dt","dd"])){var g=getActiveRange().cloneRange();extraRanges.push(g);a=a.childNodes[k-1];k=getNodeLength(a);b=a.nextSibling;getSelection().collapse(a,k);getActiveRange().setStart(a,k);getSelection().extend(b,0);getActiveRange().setEnd(b,0);deleteSelection();getSelection().removeAllRanges();getSelection().addRange(g);getActiveRange().setStart(g.startContainer,g.startOffset);getActiveRange().setEnd(g.endContainer,g.endOffset);extraRanges.pop();return}while(0<=k-1&&k-1<a.childNodes.length){if(isEditable(a.childNodes[k-1])&&isInvisible(a.childNodes[k-1])){a.removeChild(a.childNodes[k-1]);k--}else{a=a.childNodes[k-1];k=getNodeLength(a)}}getSelection().collapse(a,k);getActiveRange().setStart(a,k);getSelection().extend(b,d);getActiveRange().setEnd(b,d);deleteSelection({direction:"backward"})}};var formattableBlockNames=["address","dd","div","dt","h1","h2","h3","h4","h5","h6","p","pre"];commands.formatblock={action:function(g){if(/^<.*>$/.test(g)){g=g.slice(1,-1)}g=g.toLowerCase();if(formattableBlockNames.indexOf(g)==-1){return}var h=recordCurrentOverrides();var d=blockExtend(getActiveRange());var c=getContainedNodes(d,function(i){return isEditable(i)&&(isNonListSingleLineContainer(i)||isAllowedChild(i,"p")||isHtmlElement(i,["dd","dt"]))&&!getDescendants(i).some(isProhibitedParagraphChild)});var a=recordValues(c);for(var e=0;e<c.length;e++){var f=c[e];while(getAncestors(f).some(function(i){return isEditable(i)&&inSameEditingHost(i,f)&&isHtmlElement(i,formattableBlockNames)&&!getDescendants(i).some(isProhibitedParagraphChild)})){splitParent([f])}}restoreValues(a);while(c.length){var b;if(isSingleLineContainer(c[0])){b=[].slice.call(c[0].childNodes);var a=recordValues(b);removePreservingDescendants(c[0]);restoreValues(a);c.shift()}else{b=[];b.push(c.shift());while(c.length&&c[0]==b[b.length-1].nextSibling&&!isSingleLineContainer(c[0])&&!isHtmlElement(b[b.length-1],"BR")){b.push(c.shift())}}fixDisallowedAncestors(wrap(b,["div","p"].indexOf(g)==-1?function(i){return isHtmlElement(i,g)&&!i.attributes.length}:function(){return false},function(){return document.createElement(g)}))}restoreStatesAndValues(h)},indeterm:function(){if(!getActiveRange()){return false}var c=blockExtend(getActiveRange());var b=getAllContainedNodes(c,function(g){return isVisible(g)&&isEditable(g)&&!g.hasChildNodes()});if(!b.length){return false}var e=null;for(var d=0;d<b.length;d++){var f=b[d];while(isEditable(f.parentNode)&&inSameEditingHost(f,f.parentNode)&&!isHtmlElement(f,formattableBlockNames)){f=f.parentNode}var a="";if(isEditable(f)&&isHtmlElement(f,formattableBlockNames)&&!getDescendants(f).some(isProhibitedParagraphChild)){a=f.tagName}if(e===null){e=a}else{if(e!=a){return true}}}return false},value:function(){if(!getActiveRange()){return""}var b=blockExtend(getActiveRange());var a=getAllContainedNodes(b,function(d){return isVisible(d)&&isEditable(d)&&!d.hasChildNodes()});if(!a.length){return""}var c=a[0];while(isEditable(c.parentNode)&&inSameEditingHost(c,c.parentNode)&&!isHtmlElement(c,formattableBlockNames)){c=c.parentNode}if(isEditable(c)&&isHtmlElement(c,formattableBlockNames)&&!getDescendants(c).some(isProhibitedParagraphChild)){return c.tagName.toLowerCase()}return""}};commands.forwarddelete={action:function(){if(!getActiveRange().collapsed){deleteSelection();return}canonicalizeWhitespace(getActiveRange().startContainer,getActiveRange().startOffset);var c=getActiveRange().startContainer;var d=getActiveRange().startOffset;while(true){if(d==getNodeLength(c)&&isEditable(c.nextSibling)&&isInvisible(c.nextSibling)){c.parentNode.removeChild(c.nextSibling)}else{if(d<c.childNodes.length&&isEditable(c.childNodes[d])&&isInvisible(c.childNodes[d])){c.removeChild(c.childNodes[d])}else{if((d==getNodeLength(c)&&isInlineNode(c))||isInvisible(c)){d=1+getNodeIndex(c);c=c.parentNode}else{if(d<c.childNodes.length&&!isBlockNode(c.childNodes[d])&&!isHtmlElement(c.childNodes[d],["br","img"])&&!isCollapsedBlockProp(c.childNodes[d])){c=c.childNodes[d];d=0}else{break}}}}}if(c.nodeType==Node.TEXT_NODE&&d!=getNodeLength(c)){var b=d+1;while(b!=c.length&&/^[\u0300-\u036f\u0591-\u05bd\u05c1\u05c2]$/.test(c.data[b])){b++}getSelection().collapse(c,d);getActiveRange().setStart(c,d);getSelection().extend(c,b);getActiveRange().setEnd(c,b);deleteSelection();return}if(isInlineNode(c)){return}if(d<c.childNodes.length&&isHtmlElement(c.childNodes[d],["br","hr","img"])&&!isCollapsedBlockProp(c.childNodes[d])){getSelection().collapse(c,d);getActiveRange().setStart(c,d);getSelection().extend(c,d+1);getActiveRange().setEnd(c,d+1);deleteSelection();return}var a=c;var b=d;if(b<a.childNodes.length&&isCollapsedBlockProp(a.childNodes[b])){b++}while(true){if(b==getNodeLength(a)){b=1+getNodeIndex(a);a=a.parentNode}else{if(b<a.childNodes.length&&isEditable(a.childNodes[b])&&isInvisible(a.childNodes[b])){a.removeChild(a.childNodes[b])}else{break}}}if(isHtmlElement(a.childNodes[b-1],"table")){return}if(isHtmlElement(a.childNodes[b],"table")){getSelection().collapse(a,b);getActiveRange().setStart(a,b);getSelection().extend(a,b+1);getActiveRange().setEnd(a,b+1);return}if(d==getNodeLength(c)&&isHtmlElement(a.childNodes[b],["br","hr"])){getSelection().collapse(a,b);getActiveRange().setStart(a,b);getSelection().extend(a,b+1);getActiveRange().setEnd(a,b+1);deleteSelection();getSelection().collapse(c,d);getActiveRange().setStart(c,d);getActiveRange().collapse(true);return}while(b<a.childNodes.length){if(isEditable(a.childNodes[b])&&isInvisible(a.childNodes[b])){a.removeChild(a.childNodes[b])}else{a=a.childNodes[b];b=0}}getSelection().collapse(c,d);getActiveRange().setStart(c,d);getSelection().extend(a,b);getActiveRange().setEnd(a,b);deleteSelection()}};commands.indent={action:function(){var h=recordCurrentOverrides();var a=[];for(var g=getActiveRange().endContainer;g!=getActiveRange().commonAncestorContainer;g=g.parentNode){if(isHtmlElement(g,"LI")){a.unshift(g)}}for(var g=getActiveRange().startContainer;g!=getActiveRange().commonAncestorContainer;g=g.parentNode){if(isHtmlElement(g,"LI")){a.unshift(g)}}for(var g=getActiveRange().commonAncestorContainer;g;g=g.parentNode){if(isHtmlElement(g,"LI")){a.unshift(g)}}for(var e=0;e<a.length;e++){normalizeSublists(a[e])}var d=blockExtend(getActiveRange());var c=[];c=getContainedNodes(d,function(i){return isEditable(i)&&(isAllowedChild(i,"div")||isAllowedChild(i,"ol"))});if(isHtmlElement(c.filter(isVisible)[0],"li")&&isHtmlElement(c.filter(isVisible)[0].parentNode,["ol","ul"])){var f=c.filter(isVisible)[0].previousSibling;while(isInvisible(f)){f=f.previousSibling}if(isHtmlElement(f,"li")){normalizeSublists(f)}}while(c.length){var b=[];b.push(c.shift());while(c.length&&c[0]==b[b.length-1].nextSibling){b.push(c.shift())}indentNodes(b)}restoreStatesAndValues(h)}};commands.inserthorizontalrule={action:function(){var d=getActiveRange().startContainer;var b=getActiveRange().startOffset;var a=getActiveRange().endContainer;var c=getActiveRange().endOffset;while(b==0&&d.parentNode){b=getNodeIndex(d);d=d.parentNode}while(c==getNodeLength(a)&&a.parentNode){c=1+getNodeIndex(a);a=a.parentNode}getSelection().collapse(d,b);getActiveRange().setStart(d,b);getSelection().extend(a,c);getActiveRange().setEnd(a,c);deleteSelection({blockMerging:false});if(!isEditable(getActiveRange().startContainer)&&!isEditingHost(getActiveRange().startContainer)){return}if(getActiveRange().startContainer.nodeType==Node.TEXT_NODE&&getActiveRange().startOffset==0){var e=getActiveRange().startContainer.parentNode;var g=getNodeIndex(getActiveRange().startContainer);getSelection().collapse(e,g);getActiveRange().setStart(e,g);getActiveRange().collapse(true)}if(getActiveRange().startContainer.nodeType==Node.TEXT_NODE&&getActiveRange().startOffset==getNodeLength(getActiveRange().startContainer)){var e=getActiveRange().startContainer.parentNode;var g=1+getNodeIndex(getActiveRange().startContainer);getSelection().collapse(e,g);getActiveRange().setStart(e,g);getActiveRange().collapse(true)}var f=document.createElement("hr");getActiveRange().insertNode(f);fixDisallowedAncestors(f);getSelection().collapse(f.parentNode,1+getNodeIndex(f));getActiveRange().setStart(f.parentNode,1+getNodeIndex(f));getActiveRange().collapse(true)}};commands.inserthtml={action:function(c){deleteSelection();if(!isEditable(getActiveRange().startContainer)&&!isEditingHost(getActiveRange().startContainer)){return}var e=getActiveRange().createContextualFragment(c);var b=e.lastChild;if(!b){return}var d=getDescendants(e);if(isBlockNode(getActiveRange().startContainer)){[].filter.call(getActiveRange().startContainer.childNodes,function(f){return isEditable(f)&&isCollapsedBlockProp(f)&&getNodeIndex(f)>=getActiveRange().startOffset}).forEach(function(f){f.parentNode.removeChild(f)})}getActiveRange().insertNode(e);if(isBlockNode(getActiveRange().startContainer)&&![].some.call(getActiveRange().startContainer.childNodes,isVisible)){getActiveRange().startContainer.appendChild(document.createElement("br"))}getActiveRange().setStart(b.parentNode,1+getNodeIndex(b));getActiveRange().setEnd(b.parentNode,1+getNodeIndex(b));for(var a=0;a<d.length;a++){fixDisallowedAncestors(d[a])}}};commands.insertimage={action:function(c){if(c===""){return}deleteSelection({stripWrappers:false});var b=getActiveRange();if(!isEditable(getActiveRange().startContainer)&&!isEditingHost(getActiveRange().startContainer)){return}if(isBlockNode(b.startContainer)&&b.startContainer.childNodes.length==1&&isHtmlElement(b.startContainer.firstChild,"br")&&b.startOffset==0){b.startContainer.removeChild(b.startContainer.firstChild)}var a=document.createElement("img");a.setAttribute("src",c);b.insertNode(a);b.setStart(a.parentNode,1+getNodeIndex(a));b.setEnd(a.parentNode,1+getNodeIndex(a));getSelection().removeAllRanges();getSelection().addRange(b);a.removeAttribute("width");a.removeAttribute("height")}};commands.insertlinebreak={action:function(c){deleteSelection({stripWrappers:false});if(!isEditable(getActiveRange().startContainer)&&!isEditingHost(getActiveRange().startContainer)){return}if(getActiveRange().startContainer.nodeType==Node.ELEMENT_NODE&&!isAllowedChild("br",getActiveRange().startContainer)){return}if(getActiveRange().startContainer.nodeType!=Node.ELEMENT_NODE&&!isAllowedChild("br",getActiveRange().startContainer.parentNode)){return}if(getActiveRange().startContainer.nodeType==Node.TEXT_NODE&&getActiveRange().startOffset==0){var b=getActiveRange().startContainer.parentNode;var d=getNodeIndex(getActiveRange().startContainer);getSelection().collapse(b,d);getActiveRange().setStart(b,d);getActiveRange().setEnd(b,d)}if(getActiveRange().startContainer.nodeType==Node.TEXT_NODE&&getActiveRange().startOffset==getNodeLength(getActiveRange().startContainer)){var b=getActiveRange().startContainer.parentNode;var d=1+getNodeIndex(getActiveRange().startContainer);getSelection().collapse(b,d);getActiveRange().setStart(b,d);getActiveRange().setEnd(b,d)}var a=document.createElement("br");getActiveRange().insertNode(a);getSelection().collapse(a.parentNode,1+getNodeIndex(a));getActiveRange().setStart(a.parentNode,1+getNodeIndex(a));getActiveRange().setEnd(a.parentNode,1+getNodeIndex(a));if(isCollapsedLineBreak(a)){getActiveRange().insertNode(document.createElement("br"));getSelection().collapse(a.parentNode,1+getNodeIndex(a));getActiveRange().setStart(a.parentNode,1+getNodeIndex(a));getActiveRange().setEnd(a.parentNode,1+getNodeIndex(a))}}};commands.insertorderedlist={action:function(){toggleLists("ol")},indeterm:function(){return/^mixed( ol)?$/.test(getSelectionListState())},state:function(){return getSelectionListState()=="ol"},};commands.insertparagraph={action:function(){deleteSelection();if(!isEditable(getActiveRange().startContainer)&&!isEditingHost(getActiveRange().startContainer)){return}var d=getActiveRange().startContainer;var g=getActiveRange().startOffset;if(d.nodeType==Node.TEXT_NODE&&g!=0&&g!=getNodeLength(d)){d.splitText(g)}if(d.nodeType==Node.TEXT_NODE&&g==getNodeLength(d)){g=1+getNodeIndex(d);d=d.parentNode}if(d.nodeType==Node.TEXT_NODE||d.nodeType==Node.COMMENT_NODE){g=getNodeIndex(d);d=d.parentNode}getSelection().collapse(d,g);getActiveRange().setStart(d,g);getActiveRange().setEnd(d,g);var b=d;while(!isSingleLineContainer(b)&&isEditable(b.parentNode)&&inSameEditingHost(d,b.parentNode)){b=b.parentNode}if(isEditable(b)&&isSingleLineContainer(b)&&inSameEditingHost(d,b.parentNode)&&(b.tagName=="P"||b.tagName=="DIV")){var c=b;while(!isHtmlElement(c,["dd","dt","li"])&&isEditable(c.parentNode)){c=c.parentNode}if(isHtmlElement(c,["dd","dt","li"])){b=c}}if(!isEditable(b)||!inSameEditingHost(b,d)||!isSingleLineContainer(b)){var r=defaultSingleLineContainerName;var m=blockExtend(getActiveRange());var f=getContainedNodes(m,function(i){return isAllowedChild(i,"p")}).slice(0,1);if(!f.length){if(!isAllowedChild(r,getActiveRange().startContainer)){return}b=document.createElement(r);getActiveRange().insertNode(b);b.appendChild(document.createElement("br"));getSelection().collapse(b,0);getActiveRange().setStart(b,0);getActiveRange().setEnd(b,0);return}while(f[f.length-1].nextSibling&&isAllowedChild(f[f.length-1].nextSibling,"p")){f.push(f[f.length-1].nextSibling)}b=wrap(f,function(){return false},function(){return document.createElement(r)})}if(b.tagName=="ADDRESS"||b.tagName=="LISTING"||b.tagName=="PRE"){var q=document.createElement("br");getActiveRange().insertNode(q);getSelection().collapse(d,g+1);getActiveRange().setStart(d,g+1);getActiveRange().setEnd(d,g+1);if(!isDescendant(nextNode(q),b)){getActiveRange().insertNode(document.createElement("br"));getSelection().collapse(d,g+1);getActiveRange().setEnd(d,g+1)}return}if(["LI","DT","DD"].indexOf(b.tagName)!=-1&&(!b.hasChildNodes()||(b.childNodes.length==1&&isHtmlElement(b.firstChild,"br")))){splitParent([b]);if(!b.hasChildNodes()){b.appendChild(document.createElement("br"))}if(isHtmlElement(b,["dd","dt"])&&getAncestors(b).every(function(i){return !inSameEditingHost(b,i)||!isAllowedChild(b,i)})){b=setTagName(b,defaultSingleLineContainerName)}fixDisallowedAncestors(b);return}var o=document.createRange();o.setStart(getActiveRange().startContainer,getActiveRange().startOffset);o.setEnd(b,getNodeLength(b));while(o.startOffset==0&&!isProhibitedParagraphChild(o.startContainer)){o.setStart(o.startContainer.parentNode,getNodeIndex(o.startContainer))}while(o.startOffset==getNodeLength(o.startContainer)&&!isProhibitedParagraphChild(o.startContainer)){o.setStart(o.startContainer.parentNode,1+getNodeIndex(o.startContainer))}var k=getContainedNodes(o);var n=!k.length||(k.length==1&&isHtmlElement(k[0],"br"));var l;if(/^H[1-6]$/.test(b.tagName)&&n){l=defaultSingleLineContainerName}else{if(b.tagName=="DT"&&n){l="dd"}else{if(b.tagName=="DD"&&n){l="dt"}else{l=b.tagName.toLowerCase()}}}var a=document.createElement(l);for(var h=0;h<b.attributes.length;h++){a.setAttributeNS(b.attributes[h].namespaceURI,b.attributes[h].name,b.attributes[h].value)}a.removeAttribute("id");b.parentNode.insertBefore(a,b.nextSibling);var j=getAllContainedNodes(o);var p=o.extractContents();var e=getDescendants(p);for(var h=0;h<e.length;h++){if(e[h].nodeType==Node.ELEMENT_NODE&&j.indexOf(e[h])==-1){e[h].removeAttribute("id")}}a.appendChild(p);while(isProhibitedParagraphChild(b.lastChild)){b=b.lastChild}while(isProhibitedParagraphChild(a.lastChild)){a=a.lastChild}if(![].some.call(b.childNodes,isVisible)){b.appendChild(document.createElement("br"))}if(![].some.call(a.childNodes,isVisible)){a.appendChild(document.createElement("br"))}getSelection().collapse(a,0);getActiveRange().setStart(a,0);getActiveRange().setEnd(a,0)}};commands.inserttext={action:function(c){deleteSelection({stripWrappers:false});if(!isEditable(getActiveRange().startContainer)&&!isEditingHost(getActiveRange().startContainer)){return}if(c.length>1){for(var a=0;a<c.length;a++){commands.inserttext.action(c[a])}return}if(c==""){return}if(c=="\n"){commands.insertparagraph.action();return}var b=getActiveRange().startContainer;var h=getActiveRange().startOffset;if(0<=h-1&&h-1<b.childNodes.length&&b.childNodes[h-1].nodeType==Node.TEXT_NODE){b=b.childNodes[h-1];h=getNodeLength(b)}if(0<=h&&h<b.childNodes.length&&b.childNodes[h].nodeType==Node.TEXT_NODE){b=b.childNodes[h];h=0}var g=recordCurrentOverrides();getSelection().collapse(b,h);getActiveRange().setStart(b,h);getActiveRange().setEnd(b,h);canonicalizeWhitespace(b,h);b=getActiveRange().startContainer;h=getActiveRange().startOffset;if(b.nodeType==Node.TEXT_NODE){b.insertData(h,c);getSelection().collapse(b,h);getActiveRange().setStart(b,h);try{getSelection().extend(b,h+1)}catch(d){}getActiveRange().setEnd(b,h+1)}else{if(b.childNodes.length==1&&isCollapsedLineBreak(b.firstChild)){b.removeChild(b.firstChild)}var f=document.createTextNode(c);getActiveRange().insertNode(f);getSelection().collapse(f,0);getActiveRange().setStart(f,0);getSelection().extend(f,1);getActiveRange().setEnd(f,1)}restoreStatesAndValues(g);canonicalizeWhitespace(getActiveRange().startContainer,getActiveRange().startOffset,false);canonicalizeWhitespace(getActiveRange().endContainer,getActiveRange().endOffset,false);if(/^[ \t\n\f\r]$/.test(c)){autolink(getActiveRange().startContainer,getActiveRange().startOffset)}try{getSelection().collapseToEnd()}catch(d){}getActiveRange().collapse(false)}};commands.insertunorderedlist={action:function(){toggleLists("ul")},indeterm:function(){return/^mixed( ul)?$/.test(getSelectionListState())},state:function(){return getSelectionListState()=="ul"},};commands.justifycenter={action:function(){justifySelection("center")},indeterm:function(){if(!getActiveRange()){return false}var a=getAllContainedNodes(blockExtend(getActiveRange()),function(b){return isEditable(b)&&isVisible(b)&&!b.hasChildNodes()});return a.some(function(b){return getAlignmentValue(b)=="center"})&&a.some(function(b){return getAlignmentValue(b)!="center"})},state:function(){if(!getActiveRange()){return false}var a=getAllContainedNodes(blockExtend(getActiveRange()),function(b){return isEditable(b)&&isVisible(b)&&!b.hasChildNodes()});return a.length&&a.every(function(b){return getAlignmentValue(b)=="center"})},value:function(){if(!getActiveRange()){return""}var a=getAllContainedNodes(blockExtend(getActiveRange()),function(b){return isEditable(b)&&isVisible(b)&&!b.hasChildNodes()});if(a.length){return getAlignmentValue(a[0])}else{return"left"}},};commands.justifyfull={action:function(){justifySelection("justify")},indeterm:function(){if(!getActiveRange()){return false}var a=getAllContainedNodes(blockExtend(getActiveRange()),function(b){return isEditable(b)&&isVisible(b)&&!b.hasChildNodes()});return a.some(function(b){return getAlignmentValue(b)=="justify"})&&a.some(function(b){return getAlignmentValue(b)!="justify"})},state:function(){if(!getActiveRange()){return false}var a=getAllContainedNodes(blockExtend(getActiveRange()),function(b){return isEditable(b)&&isVisible(b)&&!b.hasChildNodes()});return a.length&&a.every(function(b){return getAlignmentValue(b)=="justify"})},value:function(){if(!getActiveRange()){return""}var a=getAllContainedNodes(blockExtend(getActiveRange()),function(b){return isEditable(b)&&isVisible(b)&&!b.hasChildNodes()});if(a.length){return getAlignmentValue(a[0])}else{return"left"}},};commands.justifyleft={action:function(){justifySelection("left")},indeterm:function(){if(!getActiveRange()){return false}var a=getAllContainedNodes(blockExtend(getActiveRange()),function(b){return isEditable(b)&&isVisible(b)&&!b.hasChildNodes()});return a.some(function(b){return getAlignmentValue(b)=="left"})&&a.some(function(b){return getAlignmentValue(b)!="left"})},state:function(){if(!getActiveRange()){return false}var a=getAllContainedNodes(blockExtend(getActiveRange()),function(b){return isEditable(b)&&isVisible(b)&&!b.hasChildNodes()});return a.length&&a.every(function(b){return getAlignmentValue(b)=="left"})},value:function(){if(!getActiveRange()){return""}var a=getAllContainedNodes(blockExtend(getActiveRange()),function(b){return isEditable(b)&&isVisible(b)&&!b.hasChildNodes()});if(a.length){return getAlignmentValue(a[0])}else{return"left"}},};commands.justifyright={action:function(){justifySelection("right")},indeterm:function(){if(!getActiveRange()){return false}var a=getAllContainedNodes(blockExtend(getActiveRange()),function(b){return isEditable(b)&&isVisible(b)&&!b.hasChildNodes()});return a.some(function(b){return getAlignmentValue(b)=="right"})&&a.some(function(b){return getAlignmentValue(b)!="right"})},state:function(){if(!getActiveRange()){return false}var a=getAllContainedNodes(blockExtend(getActiveRange()),function(b){return isEditable(b)&&isVisible(b)&&!b.hasChildNodes()});return a.length&&a.every(function(b){return getAlignmentValue(b)=="right"})},value:function(){if(!getActiveRange()){return""}var a=getAllContainedNodes(blockExtend(getActiveRange()),function(b){return isEditable(b)&&isVisible(b)&&!b.hasChildNodes()});if(a.length){return getAlignmentValue(a[0])}else{return"left"}},};commands.outdent={action:function(){var f=recordCurrentOverrides();var b=[];(function(){for(var g=getActiveRange().endContainer;g!=getActiveRange().commonAncestorContainer;g=g.parentNode){if(isHtmlElement(g,"li")){b.unshift(g)}}for(var g=getActiveRange().startContainer;g;g=g.parentNode){if(isHtmlElement(g,"li")){b.unshift(g)}}})();b.forEach(normalizeSublists);var e=blockExtend(getActiveRange());var d=getContainedNodes(e,function(g){return isEditable(g)&&(!getDescendants(g).some(isEditable)||isHtmlElement(g,["ol","ul"])||(isHtmlElement(g,"li")&&isHtmlElement(g.parentNode,["ol","ul"])))});while(d.length){while(d.length&&(isHtmlElement(d[0],["OL","UL"])||!isHtmlElement(d[0].parentNode,["OL","UL"]))){outdentNode(d.shift())}if(!d.length){break}var c=[];c.push(d.shift());while(d.length&&d[0]==c[c.length-1].nextSibling&&!isHtmlElement(d[0],["OL","UL"])){c.push(d.shift())}var a=recordValues(c);splitParent(c);c.forEach(fixDisallowedAncestors);restoreValues(a)}restoreStatesAndValues(f)}};commands.defaultparagraphseparator={action:function(a){a=a.toLowerCase();if(a=="p"||a=="div"){defaultSingleLineContainerName=a}},value:function(){return defaultSingleLineContainerName},};commands.selectall={action:function(){var a=document.body;if(!a){a=document.documentElement}if(!a){getSelection().removeAllRanges()}else{getSelection().selectAllChildren(a)}}};commands.stylewithcss={action:function(a){cssStylingFlag=String(a).toLowerCase()!="false"},state:function(){return cssStylingFlag}};commands.usecss={action:function(a){cssStylingFlag=String(a).toLowerCase()=="false"}};(function(){var a=[];for(var b in commands){a.push(b)}a.forEach(function(c){if(!("relevantCssProperty" in commands[c])){commands[c].relevantCssProperty=null}if("inlineCommandActivatedValues" in commands[c]&&!("indeterm" in commands[c])){commands[c].indeterm=function(){if(!getActiveRange()){return false}var e=getAllEffectivelyContainedNodes(getActiveRange(),isFormattableNode).map(function(f){return getEffectiveCommandValue(f,c)});var d=e.filter(function(f){return commands[c].inlineCommandActivatedValues.indexOf(f)!=-1});return d.length>=1&&e.length-d.length>=1}}if("inlineCommandActivatedValues" in commands[c]){commands[c].state=function(){if(!getActiveRange()){return false}var d=getAllEffectivelyContainedNodes(getActiveRange(),isFormattableNode);if(d.length==0){return commands[c].inlineCommandActivatedValues.indexOf(getEffectiveCommandValue(getActiveRange().startContainer,c))!=-1}else{return d.every(function(e){return commands[c].inlineCommandActivatedValues.indexOf(getEffectiveCommandValue(e,c))!=-1})}}}if("standardInlineValueCommand" in commands[c]){commands[c].indeterm=function(){if(!getActiveRange()){return false}var d=getAllEffectivelyContainedNodes(getActiveRange()).filter(isFormattableNode).map(function(f){return getEffectiveCommandValue(f,c)});for(var e=1;e<d.length;e++){if(d[e]!=d[e-1]){return true}}return false};commands[c].value=function(){if(!getActiveRange()){return""}var d=getAllEffectivelyContainedNodes(getActiveRange(),isFormattableNode)[0];if(typeof d=="undefined"){d=getActiveRange().startContainer}var e=getEffectiveCommandValue(d,c);if(e===null){return""}return e}}})})();