/*! Rangy 1.3alpha.675 by Tim Down (contains: rangy-core.js, rangy-selectionsaverestore.js, rangy-position.js) */
window.rangy=function(){function a(a,b){var c=typeof a[b];return c==m||c==l&&!!a[b]||c=="unknown"}function b(a,b){return typeof a[b]==l&&!!a[b]}function c(a,b){return typeof a[b]!=n}function d(a){return function(b,c){var d=c.length;while(d--)if(!a(b,c[d]))return!1;return!0}}function e(a){return a&&s(a,r)&&u(a,q)}function f(a,b){b?window.alert(a):typeof window.console!=n&&typeof window.console.log!=n&&window.console.log(a)}function g(a){v.initialized=!0,v.supported=!1,f("Rangy is not supported on this page in your browser. Reason: "+a,v.config.alertOnFail)}function h(a){f("Rangy warning: "+a,v.config.alertOnWarn)}function i(){if(v.initialized)return;var c,d=!1,f=!1;a(document,"createRange")&&(c=document.createRange(),s(c,p)&&u(c,o)&&(d=!0),c.detach());var h=b(document,"body")?document.body:document.getElementsByTagName("body")[0];if(!h||h.nodeName.toLowerCase()!="body"){g("No body element found");return}h&&a(h,"createTextRange")&&(c=h.createTextRange(),e(c)&&(f=!0));if(!d&&!f){g("Neither Range nor TextRange are available");return}v.initialized=!0,v.features={implementsDomRange:d,implementsTextRange:f};var i=x.concat(w);for(var j=0,k=i.length;j<k;++j)try{i[j](v)}catch(l){b(window,"console")&&a(window.console,"log")&&window.console.log("Rangy init listener threw an exception. Continuing.",l)}}function j(a){a=a||window,i();for(var b=0,c=y.length;b<c;++b)y[b](a)}function k(a){this.name=a,this.initialized=!1,this.supported=!1}var l="object",m="function",n="undefined",o=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],p=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],q=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],r=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],s=d(a),t=d(b),u=d(c),v={version:"1.3alpha.675",initialized:!1,supported:!0,util:{isHostMethod:a,isHostObject:b,isHostProperty:c,areHostMethods:s,areHostObjects:t,areHostProperties:u,isTextRange:e},features:{},modules:{},config:{alertOnFail:!0,alertOnWarn:!1,preferTextRange:!1}};v.fail=g,v.warn=h,{}.hasOwnProperty?v.util.extend=function(a,b,c){var d,e;for(var f in b)b.hasOwnProperty(f)&&(d=a[f],e=b[f],c&&d!==null&&typeof d=="object"&&e!==null&&typeof e=="object"&&v.util.extend(d,e,!0),a[f]=e);return a}:g("hasOwnProperty not supported");var w=[],x=[];v.init=i,v.addInitListener=function(a){v.initialized?a(v):w.push(a)};var y=[];v.addCreateMissingNativeApiListener=function(a){y.push(a)},v.createMissingNativeApi=j,k.prototype={fail:function(a){throw this.initialized=!0,this.supported=!1,new Error("Module '"+this.name+"' failed to load: "+a)},warn:function(a){v.warn("Module "+this.name+": "+a)},deprecationNotice:function(a,b){v.warn("DEPRECATED: "+a+" in module "+this.name+"is deprecated. Please use "+b+" instead")},createError:function(a){return new Error("Error in Rangy "+this.name+" module: "+a)}},v.createModule=function(a,b){var c=new k(a);v.modules[a]=c,x.push(function(a){b(a,c),c.initialized=!0,c.supported=!0})},v.requireModules=function(a){for(var b=0,c=a.length,d,e;b<c;++b){e=a[b],d=v.modules[e];if(!d||!(d instanceof k))throw new Error("Module '"+e+"' not found");if(!d.supported)throw new Error("Module '"+e+"' not supported")}};var z=!1,A=function(a){z||(z=!0,v.initialized||i())};if(typeof window==n){g("No window found");return}if(typeof document==n){g("No document found");return}return a(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",A,!1),a(window,"addEventListener")?window.addEventListener("load",A,!1):a(window,"attachEvent")?window.attachEvent("onload",A):g("Window does not have required addEventListener or attachEvent method"),v}(),rangy.createModule("DomUtil",function(a,b){function c(a){var b;return typeof a.namespaceURI==D||(b=a.namespaceURI)===null||b=="http://www.w3.org/1999/xhtml"}function d(a){var b=a.parentNode;return b.nodeType==1?b:null}function e(a){var b=0;while(a=a.previousSibling)b++;return b}function f(a){switch(a.nodeType){case 7:case 10:return 0;case 3:case 8:return a.length;default:return a.childNodes.length}}function g(a,b){var c=[],d;for(d=a;d;d=d.parentNode)c.push(d);for(d=b;d;d=d.parentNode)if(H(c,d))return d;return null}function h(a,b,c){var d=c?b:b.parentNode;while(d){if(d===a)return!0;d=d.parentNode}return!1}function i(a,b){return h(a,b,!0)}function j(a,b,c){var d,e=c?a:a.parentNode;while(e){d=e.parentNode;if(d===b)return e;e=d}return null}function k(a){var b=a.nodeType;return b==3||b==4||b==8}function l(a){if(!a)return!1;var b=a.nodeType;return b==3||b==8}function m(a,b){var c=b.nextSibling,d=b.parentNode;return c?d.insertBefore(a,c):d.appendChild(a),a}function n(a,b){var c=a.cloneNode(!1);return c.deleteData(0,b),a.deleteData(b,a.length-b),m(c,a),c}function o(a){if(a.nodeType==9)return a;if(typeof a.ownerDocument!=D)return a.ownerDocument;if(typeof a.document!=D)return a.document;if(a.parentNode)return o(a.parentNode);throw b.createError("getDocument: no document found for node")}function p(a){var c=o(a);if(typeof c.defaultView!=D)return c.defaultView;if(typeof c.parentWindow!=D)return c.parentWindow;throw b.createError("Cannot get a window object for node")}function q(a){if(typeof a.contentDocument!=D)return a.contentDocument;if(typeof a.contentWindow!=D)return a.contentWindow.document;throw b.createError("getIframeDocument: No Document object found for iframe element")}function r(a){if(typeof a.contentWindow!=D)return a.contentWindow;if(typeof a.contentDocument!=D)return a.contentDocument.defaultView;throw b.createError("getIframeWindow: No Window object found for iframe element")}function s(a){return E.isHostObject(a,"body")?a.body:a.getElementsByTagName("body")[0]}function t(a){return a&&E.isHostMethod(a,"setTimeout")&&E.isHostObject(a,"document")}function u(a){var b;return a?E.isHostProperty(a,"nodeType")?b=a.nodeType==1&&a.tagName.toLowerCase()=="iframe"?q(a):o(a):t(a)&&(b=a.document):b=document,b}function v(a){var b;while(b=a.parentNode)a=b;return a}function w(a,c,d,f){var h,i,k,l,m;if(a==d)return c===f?0:c<f?-1:1;if(h=j(d,a,!0))return c<=e(h)?-1:1;if(h=j(a,d,!0))return e(h)<f?-1:1;i=g(a,d),k=a===i?i:j(a,i,!0),l=d===i?i:j(d,i,!0);if(k===l)throw b.createError("comparePoints got to case 4 and childA and childB are the same!");m=i.firstChild;while(m){if(m===k)return-1;if(m===l)return 1;m=m.nextSibling}}function x(a){if(!a)return"[No node]";if(k(a))return'"'+a.data+'"';if(a.nodeType==1){var b=a.id?' id="'+a.id+'"':"";return"<"+a.nodeName+b+">["+a.childNodes.length+"]"}return a.nodeName}function y(a){var b=o(a).createDocumentFragment(),c;while(c=a.firstChild)b.appendChild(c);return b}function z(a){this.root=a,this._next=a}function A(a){return new z(a)}function B(a,b){this.node=a,this.offset=b}function C(a){this.code=this[a],this.codeName=a,this.message="DOMException: "+this.codeName}var D="undefined",E=a.util;E.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||b.fail("document missing a Node creation method"),E.isHostMethod(document,"getElementsByTagName")||b.fail("document missing getElementsByTagName method");var F=document.createElement("div");E.areHostMethods(F,["insertBefore","appendChild","cloneNode"]||!E.areHostObjects(F,["previousSibling","nextSibling","childNodes","parentNode"]))||b.fail("Incomplete Element implementation"),E.isHostProperty(F,"innerHTML")||b.fail("Element is missing innerHTML property");var G=document.createTextNode("test");E.areHostMethods(G,["splitText","deleteData","insertData","appendData","cloneNode"]||!E.areHostObjects(F,["previousSibling","nextSibling","childNodes","parentNode"])||!E.areHostProperties(G,["data"]))||b.fail("Incomplete Text Node implementation");var H=function(a,b){var c=a.length;while(c--)if(a[c]===b)return!0;return!1};z.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next,b,c;if(this._current){b=a.firstChild;if(b)this._next=b;else{c=null;while(a!==this.root&&!(c=a.nextSibling))a=a.parentNode;this._next=c}}return this._current},detach:function(){this._current=this._next=this.root=null}},B.prototype={equals:function(a){return!!a&&this.node===a.node&&this.offset==a.offset},inspect:function(){return"[DomPosition("+x(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},C.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11},C.prototype.toString=function(){return this.message},a.dom={arrayContains:H,isHtmlNamespace:c,parentElement:d,getNodeIndex:e,getNodeLength:f,getCommonAncestor:g,isAncestorOf:h,isOrIsAncestorOf:i,getClosestAncestorIn:j,isCharacterDataNode:k,isTextOrCommentNode:l,insertAfter:m,splitDataNode:n,getDocument:o,getWindow:p,getIframeWindow:r,getIframeDocument:q,getBody:s,isWindow:t,getContentDocument:u,getRootContainer:v,comparePoints:w,inspectNode:x,fragmentFromNodeChildren:y,createIterator:A,DomPosition:B},a.DOMException=C}),rangy.createModule("DomRange",function(a,b){function c(a,b){return a.nodeType!=3&&(K.isOrIsAncestorOf(a,b.startContainer)||K.isOrIsAncestorOf(a,b.endContainer))}function d(a){return K.getDocument(a.startContainer)}function e(a){return new M(a.parentNode,K.getNodeIndex(a))}function f(a){return new M(a.parentNode,K.getNodeIndex(a)+1)}function g(a,b,c){var d=a.nodeType==11?a.firstChild:a;return K.isCharacterDataNode(b)?c==b.length?K.insertAfter(a,b):b.parentNode.insertBefore(a,c==0?b:K.splitDataNode(b,c)):c>=b.childNodes.length?b.appendChild(a):b.insertBefore(a,b.childNodes[c]),d}function h(a){var b;for(var c,e=d(a.range).createDocumentFragment(),f;c=a.next();){b=a.isPartiallySelectedSubtree(),c=c.cloneNode(!b),b&&(f=a.getSubtreeIterator(),c.appendChild(h(f)),f.detach(!0));if(c.nodeType==10)throw new N("HIERARCHY_REQUEST_ERR");e.appendChild(c)}return e}function i(a,b,c){var d,e;c=c||{stop:!1};for(var f,g;f=a.next();)if(a.isPartiallySelectedSubtree()){if(b(f)===!1){c.stop=!0;return}g=a.getSubtreeIterator(),i(g,b,c),g.detach(!0);if(c.stop)return}else{d=K.createIterator(f);while(e=d.next())if(b(e)===!1){c.stop=!0;return}}}function j(a){var b;while(a.next())a.isPartiallySelectedSubtree()?(b=a.getSubtreeIterator(),j(b),b.detach(!0)):a.remove()}function k(a){for(var b,c=d(a.range).createDocumentFragment(),e;b=a.next();){a.isPartiallySelectedSubtree()?(b=b.cloneNode(!1),e=a.getSubtreeIterator(),b.appendChild(k(e)),e.detach(!0)):a.remove();if(b.nodeType==10)throw new N("HIERARCHY_REQUEST_ERR");c.appendChild(b)}return c}function l(a,b,c){var d=!!b&&!!b.length,e,f=!!c;d&&(e=new RegExp("^("+b.join("|")+")$"));var g=[];return i(new n(a,!1),function(a){(!d||e.test(a.nodeType))&&(!f||c(a))&&g.push(a)}),g}function m(a){var b=typeof a.getName=="undefined"?"Range":a.getName();return"["+b+"("+K.inspectNode(a.startContainer)+":"+a.startOffset+", "+K.inspectNode(a.endContainer)+":"+a.endOffset+")]"}function n(a,b){this.range=a,this.clonePartiallySelectedTextNodes=b;if(!a.collapsed){this.sc=a.startContainer,this.so=a.startOffset,this.ec=a.endContainer,this.eo=a.endOffset;var c=a.commonAncestorContainer;this.sc===this.ec&&K.isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc===c&&!K.isCharacterDataNode(this.sc)?this.sc.childNodes[this.so]:K.getClosestAncestorIn(this.sc,c,!0),this._last=this.ec===c&&!K.isCharacterDataNode(this.ec)?this.ec.childNodes[this.eo-1]:K.getClosestAncestorIn(this.ec,c,!0))}}function o(a){this.code=this[a],this.codeName=a,this.message="RangeException: "+this.codeName}function p(a){return function(b,c){var d,e=c?b:b.parentNode;while(e){d=e.nodeType;if(K.arrayContains(a,d))return e;e=e.parentNode}return null}}function q(a,b){if(W(a,b))throw new o("INVALID_NODE_TYPE_ERR")}function r(a){if(!a.startContainer)throw new N("INVALID_STATE_ERR")}function s(a,b){if(!K.arrayContains(b,a.nodeType))throw new o("INVALID_NODE_TYPE_ERR")}function t(a,b){if(b<0||b>(K.isCharacterDataNode(a)?a.length:a.childNodes.length))throw new N("INDEX_SIZE_ERR")}function u(a,b){if(U(a,!0)!==U(b,!0))throw new N("WRONG_DOCUMENT_ERR")}function v(a){if(V(a,!0))throw new N("NO_MODIFICATION_ALLOWED_ERR")}function w(a,b){if(!a)throw new N(b)}function x(a){return!K.arrayContains(P,a.nodeType)&&!U(a,!0)}function y(a,b){return b<=(K.isCharacterDataNode(a)?a.length:a.childNodes.length)}function z(a){return!!a.startContainer&&!!a.endContainer&&!x(a.startContainer)&&!x(a.endContainer)&&y(a.startContainer,a.startOffset)&&y(a.endContainer,a.endOffset)}function A(a){r(a);if(!z(a))throw new Error("Range error: Range is no longer valid after DOM mutation ("+a.inspect()+")")}function B(){}function C(a){a.START_TO_START=ab,a.START_TO_END=bb,a.END_TO_END=cb,a.END_TO_START=db,a.NODE_BEFORE=eb,a.NODE_AFTER=fb,a.NODE_BEFORE_AND_AFTER=gb,a.NODE_INSIDE=hb}function D(a){C(a),C(a.prototype)}function E(a,b){return function(){A(this);var c=this.startContainer,d=this.startOffset,e=this.commonAncestorContainer,g=new n(this,!0),h,j;c!==e&&(h=K.getClosestAncestorIn(c,e,!0),j=f(h),c=j.node,d=j.offset),i(g,v),g.reset();var k=a(g);return g.detach(),b(this,c,d,c,d),k}}function F(a,b,d){function g(a,b){return function(c){r(this),s(c,O),s(T(c),P);var d=(a?e:f)(c);(b?h:i)(this,d.node,d.offset)}}function h(a,c,d){var e=a.endContainer,f=a.endOffset;if(c!==a.startContainer||d!==a.startOffset){if(T(c)!=T(e)||K.comparePoints(c,d,e,f)==1)e=c,f=d;b(a,c,d,e,f)}}function i(a,c,d){var e=a.startContainer,f=a.startOffset;if(c!==a.endContainer||d!==a.endOffset){if(T(c)!=T(e)||K.comparePoints(c,d,e,f)==-1)e=c,f=d;b(a,e,f,c,d)}}function l(a,c,d){(c!==a.startContainer||d!==a.startOffset||c!==a.endContainer||d!==a.endOffset)&&b(a,c,d,c,d)}a.prototype=new B,L.extend(a.prototype,{setStart:function(a,b){r(this),q(a,!0),t(a,b),h(this,a,b)},setEnd:function(a,b){r(this),q(a,!0),t(a,b),i(this,a,b)},setStartAndEnd:function(){var a=arguments;this.setStart(a[0],a[1]);switch(a.length){case 2:this.collapse(!0);break;case 3:this.setEnd(a[0],a[2]);break;case 4:this.setEnd(a[2],a[3])}},setStartBefore:g(!0,!0),setStartAfter:g(!1,!0),setEndBefore:g(!0,!1),setEndAfter:g(!1,!1),collapse:function(a){A(this),a?b(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):b(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(a){r(this),q(a,!0),b(this,a,0,a,K.getNodeLength(a))},selectNode:function(a){r(this),q(a,!1),s(a,O);var c=e(a),d=f(a);b(this,c.node,c.offset,d.node,d.offset)},extractContents:E(k,b),deleteContents:E(j,b),canSurroundContents:function(){A(this),v(this.startContainer),v(this.endContainer);var a=new n(this,!0),b=a._first&&c(a._first,this)||a._last&&c(a._last,this);return a.detach(),!b},detach:function(){d(this)},splitBoundaries:function(){A(this);var a=this.startContainer,c=this.startOffset,d=this.endContainer,e=this.endOffset,f=a===d;K.isCharacterDataNode(d)&&e>0&&e<d.length&&K.splitDataNode(d,e),K.isCharacterDataNode(a)&&c>0&&c<a.length&&(a=K.splitDataNode(a,c),f?(e-=c,d=a):d==a.parentNode&&e>=K.getNodeIndex(a)&&e++,c=0),b(this,a,c,d,e)},normalizeBoundaries:function(){A(this);var a=this.startContainer,c=this.startOffset,d=this.endContainer,e=this.endOffset,f=function(a){var b=a.nextSibling;b&&b.nodeType==a.nodeType&&(d=a,e=a.length,a.appendData(b.data),b.parentNode.removeChild(b))},g=function(b){var f=b.previousSibling;if(f&&f.nodeType==b.nodeType){a=b;var g=b.length;c=f.length,b.insertData(0,f.data),f.parentNode.removeChild(f);if(a==d)e+=c,d=a;else if(d==b.parentNode){var h=K.getNodeIndex(b);e==h?(d=b,e=g):e>h&&e--}}},h=!0;if(K.isCharacterDataNode(d))d.length==e&&f(d);else{if(e>0){var i=d.childNodes[e-1];i&&K.isCharacterDataNode(i)&&f(i)}h=!this.collapsed}if(h){if(K.isCharacterDataNode(a))c==0&&g(a);else if(c<a.childNodes.length){var j=a.childNodes[c];j&&K.isCharacterDataNode(j)&&g(j)}}else a=d,c=e;b(this,a,c,d,e)},collapseToPoint:function(a,b){r(this),q(a,!0),t(a,b),l(this,a,b)}}),D(a)}function G(a){a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset,a.commonAncestorContainer=a.collapsed?a.startContainer:K.getCommonAncestor(a.startContainer,a.endContainer)}function H(a,b,c,d,e){a.startContainer=b,a.startOffset=c,a.endContainer=d,a.endOffset=e,G(a)}function I(a){r(a),a.startContainer=a.startOffset=a.endContainer=a.endOffset=null,a.collapsed=a.commonAncestorContainer=null}function J(a){this.startContainer=a,this.startOffset=0,this.endContainer=a,this.endOffset=0,G(this)}a.requireModules(["DomUtil"]);var K=a.dom,L=a.util,M=K.DomPosition,N=a.DOMException;n.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next;return a&&(this._next=a!==this._last?a.nextSibling:null,K.isCharacterDataNode(a)&&this.clonePartiallySelectedTextNodes&&(a===this.ec&&(a=a.cloneNode(!0)).deleteData(this.eo,a.length-this.eo),this._current===this.sc&&(a=a.cloneNode(!0)).deleteData(0,this.so))),a},remove:function(){var a=this._current,b,c;!K.isCharacterDataNode(a)||a!==this.sc&&a!==this.ec?a.parentNode&&a.parentNode.removeChild(a):(b=a===this.sc?this.so:0,c=a===this.ec?this.eo:a.length,b!=c&&a.deleteData(b,c-b))},isPartiallySelectedSubtree:function(){var a=this._current;return c(a,this.range)},getSubtreeIterator:function(){var a;if(this.isSingleCharacterDataNode)a=this.range.cloneRange(),a.collapse(!1);else{a=new J(d(this.range));var b=this._current,c=b,e=0,f=b,g=K.getNodeLength(b);K.isOrIsAncestorOf(b,this.sc)&&(c=this.sc,e=this.so),K.isOrIsAncestorOf(b,this.ec)&&(f=this.ec,g=this.eo),H(a,c,e,f,g)}return new n(a,this.clonePartiallySelectedTextNodes)},detach:function(a){a&&this.range.detach(),this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}},o.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2},o.prototype.toString=function(){return this.message};var O=[1,3,4,5,7,8,10],P=[2,9,11],Q=[5,6,10,12],R=[1,3,4,5,7,8,10,11],S=[1,3,4,5,7,8],T=K.getRootContainer,U=p([9,11]),V=p(Q),W=p([6,10,12]),X=document.createElement("style"),Y=!1;try{X.innerHTML="<b>x</b>",Y=X.firstChild.nodeType==3}catch(Z){}a.features.htmlParsingConforms=Y;var $=Y?function(a){var b=this.startContainer,c=K.getDocument(b);if(!b)throw new N("INVALID_STATE_ERR");var d=null;return b.nodeType==1?d=b:K.isCharacterDataNode(b)&&(d=K.parentElement(b)),d===null||d.nodeName=="HTML"&&K.isHtmlNamespace(K.getDocument(d).documentElement)&&K.isHtmlNamespace(d)?d=c.createElement("body"):d=d.cloneNode(!1),d.innerHTML=a,K.fragmentFromNodeChildren(d)}:function(a){r(this);var b=d(this),c=b.createElement("body");return c.innerHTML=a,K.fragmentFromNodeChildren(c)},_=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],ab=0,bb=1,cb=2,db=3,eb=0,fb=1,gb=2,hb=3;B.prototype={compareBoundaryPoints:function(a,b){A(this),u(this.startContainer,b.startContainer);var c,d,e,f,g=a==db||a==ab?"start":"end",h=a==bb||a==ab?"start":"end";return c=this[g+"Container"],d=this[g+"Offset"],e=b[h+"Container"],f=b[h+"Offset"],K.comparePoints(c,d,e,f)},insertNode:function(a){A(this),s(a,R),v(this.startContainer);if(K.isOrIsAncestorOf(a,this.startContainer))throw new N("HIERARCHY_REQUEST_ERR");var b=g(a,this.startContainer,this.startOffset);this.setStartBefore(b)},cloneContents:function(){A(this);var a,b;if(this.collapsed)return d(this).createDocumentFragment();if(this.startContainer===this.endContainer&&K.isCharacterDataNode(this.startContainer))return a=this.startContainer.cloneNode(!0),a.data=a.data.slice(this.startOffset,this.endOffset),b=d(this).createDocumentFragment(),b.appendChild(a),b;var c=new n(this,!0);return a=h(c),c.detach(),a},canSurroundContents:function(){A(this),v(this.startContainer),v(this.endContainer);var a=new n(this,!0),b=a._first&&c(a._first,this)||a._last&&c(a._last,this);return a.detach(),!b},surroundContents:function(a){s(a,S);if(!this.canSurroundContents())throw new o("BAD_BOUNDARYPOINTS_ERR");var b=this.extractContents();if(a.hasChildNodes())while(a.lastChild)a.removeChild(a.lastChild);g(a,this.startContainer,this.startOffset),a.appendChild(b),this.selectNode(a)},cloneRange:function(){A(this);var a=new J(d(this)),b=_.length,c;while(b--)c=_[b],a[c]=this[c];return a},toString:function(){A(this);var a=this.startContainer;if(a===this.endContainer&&K.isCharacterDataNode(a))return a.nodeType==3||a.nodeType==4?a.data.slice(this.startOffset,this.endOffset):"";var b=[],c=new n(this,!0);return i(c,function(a){(a.nodeType==3||a.nodeType==4)&&b.push(a.data)}),c.detach(),b.join("")},compareNode:function(a){A(this);var b=a.parentNode,c=K.getNodeIndex(a);if(!b)throw new N("NOT_FOUND_ERR");var d=this.comparePoint(b,c),e=this.comparePoint(b,c+1);return d<0?e>0?gb:eb:e>0?fb:hb},comparePoint:function(a,b){return A(this),w(a,"HIERARCHY_REQUEST_ERR"),u(a,this.startContainer),K.comparePoints(a,b,this.startContainer,this.startOffset)<0?-1:K.comparePoints(a,b,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:$,toHtml:function(){A(this);var a=this.commonAncestorContainer.parentNode.cloneNode(!1);return a.appendChild(this.cloneContents()),a.innerHTML},intersectsNode:function(a,b){A(this),w(a,"NOT_FOUND_ERR");if(K.getDocument(a)!==d(this))return!1;var c=a.parentNode,e=K.getNodeIndex(a);w(c,"NOT_FOUND_ERR");var f=K.comparePoints(c,e,this.endContainer,this.endOffset),g=K.comparePoints(c,e+1,this.startContainer,this.startOffset);return b?f<=0&&g>=0:f<0&&g>0},isPointInRange:function(a,b){return A(this),w(a,"HIERARCHY_REQUEST_ERR"),u(a,this.startContainer),K.comparePoints(a,b,this.startContainer,this.startOffset)>=0&&K.comparePoints(a,b,this.endContainer,this.endOffset)<=0},intersectsRange:function(a,b){A(this);if(d(a)!=d(this))throw new N("WRONG_DOCUMENT_ERR");var c=K.comparePoints(this.startContainer,this.startOffset,a.endContainer,a.endOffset),e=K.comparePoints(this.endContainer,this.endOffset,a.startContainer,a.startOffset);return b?c<=0&&e>=0:c<0&&e>0},intersection:function(a){if(this.intersectsRange(a)){var b=K.comparePoints(this.startContainer,this.startOffset,a.startContainer,a.startOffset),c=K.comparePoints(this.endContainer,this.endOffset,a.endContainer,a.endOffset),d=this.cloneRange();return b==-1&&d.setStart(a.startContainer,a.startOffset),c==1&&d.setEnd(a.endContainer,a.endOffset),d}return null},union:function(a){if(this.intersectsRange(a,!0)){var b=this.cloneRange();return K.comparePoints(a.startContainer,a.startOffset,this.startContainer,this.startOffset)==-1&&b.setStart(a.startContainer,a.startOffset),K.comparePoints(a.endContainer,a.endOffset,this.endContainer,this.endOffset)==1&&b.setEnd(a.endContainer,a.endOffset),b}throw new o("Ranges do not intersect")},containsNode:function(a,b){return b?this.intersectsNode(a,!1):this.compareNode(a)==hb},containsNodeContents:function(a){return this.comparePoint(a,0)>=0&&this.comparePoint(a,K.getNodeLength(a))<=0},containsRange:function(a){var b=this.intersection(a);return b!==null&&a.equals(b)},containsNodeText:function(a){var b=this.cloneRange();b.selectNode(a);var c=b.getNodes([3]);if(c.length>0){b.setStart(c[0],0);var d=c.pop();b.setEnd(d,d.length);var e=this.containsRange(b);return b.detach(),e}return this.containsNodeContents(a)},getNodes:function(a,b){return A(this),l(this,a,b)},getDocument:function(){return d(this)},collapseBefore:function(a){r(this),this.setEndBefore(a),this.collapse(!1)},collapseAfter:function(a){r(this),this.setStartAfter(a),this.collapse(!0)},getName:function(){return"DomRange"},equals:function(a){return J.rangesEqual(this,a)},isValid:function(){return z(this)},inspect:function(){return m(this)}},F(J,H,I),a.rangePrototype=B.prototype,L.extend(J,{rangeProperties:_,RangeIterator:n,copyComparisonConstants:D,createPrototypeRange:F,inspect:m,getRangeDocument:d,rangesEqual:function(a,b){return a.startContainer===b.startContainer&&a.startOffset===b.startOffset&&a.endContainer===b.endContainer&&a.endOffset===b.endOffset}}),a.DomRange=J,a.RangeException=o}),rangy.createModule("WrappedRange",function(a,b){function c(a,c){a=i.getContentDocument(a);if(!a)throw b.createError(c+"(): Parameter must be a Document or other DOM node, or a Window object");return a}function d(a){var b=a.parentElement(),c=a.duplicate();c.collapse(!0);var d=c.parentElement();c=a.duplicate(),c.collapse(!1);var e=c.parentElement(),f=d==e?d:i.getCommonAncestor(d,e);return f==b?f:i.getCommonAncestor(b,f)}function e(a){return a.compareEndPoints("StartToEnd",a)==0}function f(a,b,c,d,e){var f=a.duplicate();f.collapse(c);var g=f.parentElement();i.isOrIsAncestorOf(b,g)||(g=b);if(!g.canHaveHTML)return new k(g.parentNode,i.getNodeIndex(g));var h=i.getDocument(g).createElement("span");h.parentNode&&h.parentNode.removeChild(h);var j,l=c?"StartToStart":"StartToEnd",m,n,o,p,q=e&&e.containerElement==g?e.nodeIndex:0,r=g.childNodes.length,s=r,t=s;for(;;){t==r?g.appendChild(h):g.insertBefore(h,g.childNodes[t]),f.moveToElementText(h),j=f.compareEndPoints(l,a);if(j==0||q==s)break;if(j==-1){if(s==q+1)break;q=t}else s=s==q+1?q:t;t=Math.floor((q+s)/2),g.removeChild(h)}p=h.nextSibling;if(j==-1&&p&&i.isCharacterDataNode(p)){f.setEndPoint(c?"EndToStart":"EndToEnd",a);var u;if(/[\r\n]/.test(p.data)){var v=f.duplicate(),w=v.text.replace(/\r\n/g,"\r").length;u=v.moveStart("character",w);while((j=v.compareEndPoints("StartToEnd",v))==-1)u++,v.moveStart("character",1)}else u=f.text.length;o=new k(p,u)}else m=(d||!c)&&h.previousSibling,n=(d||c)&&h.nextSibling,n&&i.isCharacterDataNode(n)?o=new k(n,0):m&&i.isCharacterDataNode(m)?o=new k(m,m.length):o=new k(g,i.getNodeIndex(h));return h.parentNode.removeChild(h),{boundaryPosition:o,nodeInfo:{nodeIndex:t,containerElement:g}}}function g(a,b){var c,d,e=a.offset,f=i.getDocument(a.node),g,h,j=f.body.createTextRange(),k=i.isCharacterDataNode(a.node);return k?(c=a.node,d=c.parentNode):(h=a.node.childNodes,c=e<h.length?h[e]:null,d=a.node),g=f.createElement("span"),g.innerHTML="&#feff;",c?d.insertBefore(g,c):d.appendChild(g),j.moveToElementText(g),j.collapse(!b),d.removeChild(g),k&&j[b?"moveStart":"moveEnd"]("character",e),j}a.requireModules(["DomUtil","DomRange"]);var h,i=a.dom,j=a.util,k=i.DomPosition,l=a.DomRange;if(a.features.implementsDomRange&&(!a.features.implementsTextRange||!a.config.preferTextRange))(function(){function a(a){var b=f.length,c;while(b--)c=f[b],a[c]=a.nativeRange[c];a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset}function c(a,b,c,d,e){var f=a.startContainer!==b||a.startOffset!=c,g=a.endContainer!==d||a.endOffset!=e;if(f||g)a.setEnd(d,e),a.setStart(b,c)}function d(a){a.nativeRange.detach(),a.detached=!0;var b=f.length,c;while(b--)c=f[b],a[c]=null}var e,f=l.rangeProperties,g;h=function(c){if(!c)throw b.createError("WrappedRange: Range must be specified");this.nativeRange=c,a(this)},l.createPrototypeRange(h,c,d),e=h.prototype,e.selectNode=function(b){this.nativeRange.selectNode(b),a(this)},e.cloneContents=function(){return this.nativeRange.cloneContents()},e.surroundContents=function(b){this.nativeRange.surroundContents(b),a(this)},e.collapse=function(b){this.nativeRange.collapse(b),a(this)},e.cloneRange=function(){return new h(this.nativeRange.cloneRange())},e.refresh=function(){a(this)},e.toString=function(){return this.nativeRange.toString()};var k=document.createTextNode("test");i.getBody(document).appendChild(k);var m=document.createRange();m.setStart(k,0),m.setEnd(k,0);try{m.setStart(k,1),e.setStart=function(b,c){this.nativeRange.setStart(b,c),a(this)},e.setEnd=function(b,c){this.nativeRange.setEnd(b,c),a(this)},g=function(b){return function(c){this.nativeRange[b](c),a(this)}}}catch(n){e.setStart=function(b,c){try{this.nativeRange.setStart(b,c)}catch(d){this.nativeRange.setEnd(b,c),this.nativeRange.setStart(b,c)}a(this)},e.setEnd=function(b,c){try{this.nativeRange.setEnd(b,c)}catch(d){this.nativeRange.setStart(b,c),this.nativeRange.setEnd(b,c)}a(this)},g=function(b,c){return function(d){try{this.nativeRange[b](d)}catch(e){this.nativeRange[c](d),this.nativeRange[b](d)}a(this)}}}e.setStartBefore=g("setStartBefore","setEndBefore"),e.setStartAfter=g("setStartAfter","setEndAfter"),e.setEndBefore=g("setEndBefore","setStartBefore"),e.setEndAfter=g("setEndAfter","setStartAfter"),m.selectNodeContents(k),m.startContainer==k&&m.endContainer==k&&m.startOffset==0&&m.endOffset==k.length?e.selectNodeContents=function(b){this.nativeRange.selectNodeContents(b),a(this)}:e.selectNodeContents=function(a){this.setStart(a,0),this.setEnd(a,l.getEndOffset(a))},m.selectNodeContents(k),m.setEnd(k,3);var o=document.createRange();o.selectNodeContents(k),o.setEnd(k,4),o.setStart(k,2),m.compareBoundaryPoints(m.START_TO_END,o)==-1&&m.compareBoundaryPoints(m.END_TO_START,o)==1?e.compareBoundaryPoints=function(a,b){return b=b.nativeRange||b,a==b.START_TO_END?a=b.END_TO_START:a==b.END_TO_START&&(a=b.START_TO_END),this.nativeRange.compareBoundaryPoints(a,b)}:e.compareBoundaryPoints=function(a,b){return this.nativeRange.compareBoundaryPoints(a,b.nativeRange||b)};var p=document.createElement("div");p.innerHTML="123";var q=p.firstChild;document.body.appendChild(p),m.setStart(q,1),m.setEnd(q,2),m.deleteContents(),q.data=="13"&&(e.deleteContents=function(){this.nativeRange.deleteContents(),a(this)},e.extractContents=function(){var b=this.nativeRange.extractContents();return a(this),b}),document.body.removeChild(p),j.isHostMethod(m,"createContextualFragment")&&(e.createContextualFragment=function(a){return this.nativeRange.createContextualFragment(a)}),i.getBody(document).removeChild(k),m.detach(),o.detach()})(),a.createNativeRange=function(a){return a=c(a,"createNativeRange"),a.createRange()};else if(a.features.implementsTextRange){h=function(a){this.textRange=a,this.refresh()},h.prototype=new l(document),h.prototype.refresh=function(){var a,b,c,g=d(this.textRange);e(this.textRange)?b=a=f(this.textRange,g,!0,!0).boundaryPosition:(c=f(this.textRange,g,!0,!1),a=c.boundaryPosition,b=f(this.textRange,g,!1,!1,c.nodeInfo).boundaryPosition),this.setStart(a.node,a.offset),this.setEnd(b.node,b.offset)},l.copyComparisonConstants(h);var m=function(){return this}();typeof m.Range=="undefined"&&(m.Range=h),a.createNativeRange=function(a){return a=c(a,"createNativeRange"),a.body.createTextRange()}}a.features.implementsTextRange&&(h.rangeToTextRange=function(a){if(a.collapsed)return g(new k(a.startContainer,a.startOffset),!0);var b=g(new k(a.startContainer,a.startOffset),!0),c=g(new k(a.endContainer,a.endOffset),!1),d=i.getDocument(a.startContainer).body.createTextRange();return d.setEndPoint("StartToStart",b),d.setEndPoint("EndToEnd",c),d}),h.prototype.getName=function(){return"WrappedRange"},a.WrappedRange=h,a.createRange=function(b){return b=c(b,"createRange"),new h(a.createNativeRange(b))},a.createRangyRange=function(a){return a=c(a,"createRangyRange"),new l(a)},a.createIframeRange=function(c){return b.deprecationNotice("createIframeRange()","createRange(iframeEl)"),a.createRange(c)},a.createIframeRangyRange=function(c){return b.deprecationNotice("createIframeRangyRange()","createRangyRange(iframeEl)"),a.createRangyRange(c)},a.addCreateMissingNativeApiListener(function(b){var c=b.document;typeof c.createRange=="undefined"&&(c.createRange=function(){return a.createRange(c)}),c=b=null})}),rangy.createModule("WrappedSelection",function(a,b){function c(a){return typeof a=="string"?a=="backward":!!a}function d(a,c){if(!a)return window;if(x.isWindow(a))return a;if(a instanceof q)return a.win;var d=x.getContentDocument(a);if(!d)throw b.createError(c+"(): "+"Parameter must be a Window object or DOM node");return x.getWindow(d)}function e(a){return d(a,"getWinSelection").getSelection()}function f(a){return d(a,"getDocSelection").document.selection}function g(a,b,c){var d=c?"end":"start",e=c?"start":"end";a.anchorNode=b[d+"Container"],a.anchorOffset=b[d+"Offset"],a.focusNode=b[e+"Container"],a.focusOffset=b[e+"Offset"]}function h(a){var b=a.nativeSelection;a.anchorNode=b.anchorNode,a.anchorOffset=b.anchorOffset,a.focusNode=b.focusNode,a.focusOffset=b.focusOffset}function i(a){a.anchorNode=a.focusNode=null,a.anchorOffset=a.focusOffset=0,a.rangeCount=0,a.isCollapsed=!0,a._ranges.length=0}function j(b){var c;return b instanceof z?(c=a.createNativeRange(b.getDocument()),c.setEnd(b.endContainer,b.endOffset),c.setStart(b.startContainer,b.startOffset)):b instanceof A?c=b.nativeRange:a.features.implementsDomRange&&b instanceof x.getWindow(b.startContainer).Range&&(c=b),c}function k(a){if(!a.length||a[0].nodeType!=1)return!1;for(var b=1,c=a.length;b<c;++b)if(!x.isAncestorOf(a[0],a[b]))return!1;return!0}function l(a){var c=a.getNodes();if(!k(c))throw b.createError("getSingleElementFromRange: range "+a.inspect()+" did not consist of a single element");return c[0]}function m(a){return!!a&&typeof a.text!="undefined"}function n(a,b){var c=new A(b);a._ranges=[c],g(a,c,!1),a.rangeCount=1,a.isCollapsed=c.collapsed}function o(b){b._ranges.length=0;if(b.docSelection.type=="None")i(b);else{var c=b.docSelection.createRange();if(m(c))n(b,c);else{b.rangeCount=c.length;var d,e=x.getDocument(c.item(0));for(var f=0;f<b.rangeCount;++f)d=a.createRange(e),d.selectNode(c.item(f)),b._ranges.push(d);b.isCollapsed=b.rangeCount==1&&b._ranges[0].collapsed,g(b,b._ranges[b.rangeCount-1],!1)}}}function p(a,c){var d=a.docSelection.createRange(),e=l(c),f=x.getDocument(d.item(0)),g=x.getBody(f).createControlRange();for(var h=0,i=d.length;h<i;++h)g.add(d.item(h));try{g.add(e)}catch(j){throw b.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}g.select(),o(a)}function q(a,b,c){this.nativeSelection=a,this.docSelection=b,this._ranges=[],this.win=c,this.refresh()}function r(a){a.win=a.anchorNode=a.focusNode=a._ranges=null,a.detached=!0}function s(a,b){var c=U.length,d,e;while(c--){d=U[c],e=d.selection;if(b=="deleteAll")r(e);else if(d.win==a)return b=="delete"?(U.splice(c,1),!0):e}return b=="deleteAll"&&(U.length=0),null}function t(a,c){var d=x.getDocument(c[0].startContainer),e=x.getBody(d).createControlRange();for(var f=0,g;f<rangeCount;++f){g=l(c[f]);try{e.add(g)}catch(h){throw b.createError("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)")}}e.select(),o(a)}function u(a,b){if(a.anchorNode&&x.getDocument(a.anchorNode)!==x.getDocument(b))throw new B("WRONG_DOCUMENT_ERR")}function v(a){var b=[],c=new C(a.anchorNode,a.anchorOffset),d=new C(a.focusNode,a.focusOffset),e=typeof a.getName=="function"?a.getName():"Selection";if(typeof a.rangeCount!="undefined")for(var f=0,g=a.rangeCount;f<g;++f)b[f]=z.inspect(a.getRangeAt(f));return"["+e+"(Ranges: "+b.join(", ")+")(anchor: "+c.inspect()+", focus: "+d.inspect()+"]"}a.requireModules(["DomUtil","DomRange","WrappedRange"]),a.config.checkSelectionRanges=!0;var w="boolean",x=a.dom,y=a.util,z=a.DomRange,A=a.WrappedRange,B=a.DOMException,C=x.DomPosition,D,E,F="Control",G=a.util.isHostMethod(window,"getSelection"),H=a.util.isHostObject(document,"selection");a.features.implementsWinGetSelection=G,a.features.implementsDocSelection=H;var I=H&&(!G||a.config.preferTextRange);I?(D=f,a.isSelectionValid=function(a){var b=d(a,"isSelectionValid").document,c=b.selection;return c.type!="None"||x.getDocument(c.createRange().parentElement())==b}):G?(D=e,a.isSelectionValid=function(){return!0}):b.fail("Neither document.selection or window.getSelection() detected."),a.getNativeSelection=D;var J=D(),K=a.createNativeRange(document),L=x.getBody(document),M=y.areHostProperties(J,["anchorNode","focusNode","anchorOffset","focusOffset"]);a.features.selectionHasAnchorAndFocus=M;var N=y.isHostMethod(J,"extend");a.features.selectionHasExtend=N;var O=typeof J.rangeCount=="number";a.features.selectionHasRangeCount=O;var P=!1,Q=!0;y.areHostMethods(J,["addRange","getRangeAt","removeAllRanges"])&&typeof J.rangeCount=="number"&&a.features.implementsDomRange&&function(){var a=window.getSelection();if(a){var b=x.getBody(document),c=b.appendChild(document.createElement("div"));c.contentEditable="false";var d=c.appendChild(document.createTextNode("   ")),e=document.createRange();e.setStart(d,1),e.collapse(!0),a.addRange(e),Q=a.rangeCount==1,a.removeAllRanges();var f=e.cloneRange();e.setStart(d,0),f.setEnd(d,3),f.setStart(d,2),a.addRange(e),a.addRange(f),P=a.rangeCount==2,b.removeChild(c),a.removeAllRanges(),e.detach(),f.detach()}}(),a.features.selectionSupportsMultipleRanges=P,a.features.collapsedNonEditableSelectionsSupported=Q;var R=!1,S;L&&y.isHostMethod(L,"createControlRange")&&(S=L.createControlRange(),y.areHostProperties(S,["item","add"])&&(R=!0)),a.features.implementsControlRange=R,M?E=function(a){return a.anchorNode===a.focusNode&&a.anchorOffset===a.focusOffset}:E=function(a){return a.rangeCount?a.getRangeAt(a.rangeCount-1).collapsed:!1};var T;y.isHostMethod(J,"getRangeAt")?T=function(a,b){try{return a.getRangeAt(b)}catch(c){return null}}:M&&(T=function(b){var c=x.getDocument(b.anchorNode),d=a.createRange(c);return d.setStart(b.anchorNode,b.anchorOffset),d.setEnd(b.focusNode,b.focusOffset),d.collapsed!==this.isCollapsed&&(d.setStart(b.focusNode,b.focusOffset),d.setEnd(b.anchorNode,b.anchorOffset)),d});var U=[];a.getSelection=function(a){if(a&&a instanceof q)return a.refresh(),a;a=d(a,"getSelection");var b=s(a),c=D(a),e=H?f(a):null;return b?(b.nativeSelection=c,b.docSelection=e,b.refresh()):(b=new q(c,e,a),U.push({win:a,selection:b})),b},a.getIframeSelection=function(c){return b.deprecationNotice("getIframeSelection()","getSelection(iframeEl)"),a.getSelection(x.getIframeWindow(c))};var V=q.prototype;if(!I&&M&&y.areHostMethods(J,["removeAllRanges","addRange"])){V.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),i(this)};var W=function(b,c){var d=z.getRangeDocument(c),e=a.createRange(d);e.collapseToPoint(c.endContainer,c.endOffset),b.nativeSelection.addRange(j(e)),b.nativeSelection.extend(c.startContainer,c.startOffset),b.refresh()};O?V.addRange=function(b,d){if(R&&H&&this.docSelection.type==F)p(this,b);else if(c(d)&&N)W(this,b);else{var e;P?e=this.rangeCount:(this.removeAllRanges(),e=0),this.nativeSelection.addRange(j(b).cloneRange()),this.rangeCount=this.nativeSelection.rangeCount;if(this.rangeCount==e+1){if(a.config.checkSelectionRanges){var f=T(this.nativeSelection,this.rangeCount-1);f&&!z.rangesEqual(f,b)&&(b=new A(f))}this._ranges[this.rangeCount-1]=b,g(this,b,Z(this.nativeSelection)),this.isCollapsed=E(this)}else this.refresh()}}:V.addRange=function(a,b){c(b)&&N?W(this,a):(this.nativeSelection.addRange(j(a)),this.refresh())},V.setRanges=function(a){if(R&&a.length>1)t(this,a);else{this.removeAllRanges();for(var b=0,c=a.length;b<c;++b)this.addRange(a[b])}}}else{if(!(y.isHostMethod(J,"empty")&&y.isHostMethod(K,"select")&&R&&I))return b.fail("No means of selecting a Range or TextRange was found"),!1;V.removeAllRanges=function(){try{this.docSelection.empty();if(this.docSelection.type!="None"){var a;if(this.anchorNode)a=x.getDocument(this.anchorNode);else if(this.docSelection.type==F){var b=this.docSelection.createRange();b.length&&(a=x.getDocument(b.item(0)).body.createTextRange())}if(a){var c=a.body.createTextRange();c.select(),this.docSelection.empty()}}}catch(d){}i(this)},V.addRange=function(a){this.docSelection.type==F?p(this,a):(A.rangeToTextRange(a).select(),this._ranges[0]=a,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,g(this,a,!1))},V.setRanges=function(a){this.removeAllRanges();var b=a.length;b>1?t(this,a):b&&this.addRange(a[0])}}V.getRangeAt=function(a){if(a<0||a>=this.rangeCount)throw new B("INDEX_SIZE_ERR");return this._ranges[a].cloneRange()};var X;if(I)X=function(b){var c;a.isSelectionValid(b.win)?c=b.docSelection.createRange():(c=x.getBody(b.win.document).createTextRange(),c.collapse(!0)),b.docSelection.type==F?o(b):m(c)?n(b,c):i(b)};else if(y.isHostMethod(J,"getRangeAt")&&typeof J.rangeCount=="number")X=function(b){if(R&&H&&b.docSelection.type==F)o(b);else{b._ranges.length=b.rangeCount=b.nativeSelection.rangeCount;if(b.rangeCount){for(var c=0,d=b.rangeCount;c<d;++c)b._ranges[c]=new a.WrappedRange(b.nativeSelection.getRangeAt(c));g(b,b._ranges[b.rangeCount-1],Z(b.nativeSelection)),b.isCollapsed=E(b)}else i(b)}};else{if(!M||typeof J.isCollapsed!=w||typeof K.collapsed!=w||!a.features.implementsDomRange)return b.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;X=function(a){var b,c=a.nativeSelection;c.anchorNode?(b=T(c,0),a._ranges=[b],a.rangeCount=1,h(a),a.isCollapsed=E(a)):i(a)}}V.refresh=function(a){var b=a?this._ranges.slice(0):null,c=this.isBackward();X(this);if(a){var d=b.length;if(d!=this._ranges.length)return!0;if(this.isBackward()!=c)return!0;while(d--)if(!z.rangesEqual(b[d],this._ranges[d]))return!0;return!1}};var Y=function(b,c){var d=b.getAllRanges();b.removeAllRanges();for(var e=0,f=d.length;e<f;++e)a.DomRange.rangesEqual(c,d[e])||b.addRange(d[e]);b.rangeCount||i(b)};R?V.removeRange=function(a){if(this.docSelection.type==F){var b=this.docSelection.createRange(),c=l(a),d=x.getDocument(b.item(0)),e=x.getBody(d).createControlRange(),f,g=!1;for(var h=0,i=b.length;h<i;++h)f=b.item(h),f!==c||g?e.add(b.item(h)):g=!0;e.select(),o(this)}else Y(this,a)}:V.removeRange=function(a){Y(this,a)};var Z;!I&&M&&a.features.implementsDomRange?(Z=function(a){var b=!1;return a.anchorNode&&(b=x.comparePoints(a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset)==1),b},V.isBackward=function(){return Z(this)}):Z=V.isBackward=function(){return!1},V.isBackwards=V.isBackward,V.toString=function(){var a=[];for(var b=0,c=this.rangeCount;b<c;++b)a[b]=""+this._ranges[b];return a.join("")},V.collapse=function(b,c){u(this,b);var d=a.createRange(b);d.collapseToPoint(b,c),this.setSingleRange(d),this.isCollapsed=!0},V.collapseToStart=function(){if(!this.rangeCount)throw new B("INVALID_STATE_ERR");var a=this._ranges[0];this.collapse(a.startContainer,a.startOffset)},V.collapseToEnd=function(){if(!this.rangeCount)throw new B("INVALID_STATE_ERR");var a=this._ranges[this.rangeCount-1];this.collapse(a.endContainer,a.endOffset)},V.selectAllChildren=function(b){u(this,b);var c=a.createRange(b);c.selectNodeContents(b),this.removeAllRanges(),this.addRange(c)},V.deleteFromDocument=function(){if(R&&H&&this.docSelection.type==F){var a=this.docSelection.createRange(),b;while(a.length)b=a.item(0),a.remove(b),b.parentNode.removeChild(b);this.refresh()}else if(this.rangeCount){var c=this.getAllRanges();if(c.length){this.removeAllRanges();for(var d=0,e=c.length;d<e;++d)c[d].deleteContents();this.addRange(c[e-1])}}},V.getAllRanges=function(){var a=[];for(var b=0,c=this._ranges.length;b<c;++b)a[b]=this.getRangeAt(b);return a},V.setSingleRange=function(a,b){this.removeAllRanges(),this.addRange(a,b)},V.containsNode=function(a,b){for(var c=0,d=this._ranges.length;c<d;++c)if(this._ranges[c].containsNode(a,b))return!0;return!1},V.toHtml=function(){var a=[];if(this.rangeCount)for(var b=0,c=this._ranges.length;b<c;++b)a.push(this._ranges[b].toHtml());return a.join("")},V.getName=function(){return"WrappedSelection"},V.inspect=function(){return v(this)},V.detach=function(){s(this.win,"delete"),r(this)},q.detachAll=function(){s(null,"deleteAll")},q.inspect=v,q.isDirectionBackward=c,a.Selection=q,a.selectionPrototype=V,a.addCreateMissingNativeApiListener(function(b){typeof b.getSelection=="undefined"&&(b.getSelection=function(){return a.getSelection(b)}),b=null})});rangy.createModule("SaveRestore",function(a,b){function c(a,b){return(b||document).getElementById(a)}function d(a,b){var c="selectionBoundary_"+ +(new Date)+"_"+(""+Math.random()).slice(2),d,e=o.getDocument(a.startContainer),f=a.cloneRange();return f.collapse(b),d=e.createElement("span"),d.id=c,d.style.lineHeight="0",d.style.display="none",d.className="rangySelectionBoundary",d.appendChild(e.createTextNode(p)),f.insertNode(d),f.detach(),d}function e(a,d,e,f){var g=c(e,a);g?(d[f?"setStartBefore":"setEndBefore"](g),g.parentNode.removeChild(g)):b.warn("Marker element has been removed. Cannot restore selection.")}function f(a,b){return b.compareBoundaryPoints(a.START_TO_START,a)}function g(b,c){var e,f,g=a.DomRange.getRangeDocument(b),h=b.toString();return b.collapsed?(f=d(b,!1),{document:g,markerId:f.id,collapsed:!0}):(f=d(b,!1),e=d(b,!0),{document:g,startMarkerId:e.id,endMarkerId:f.id,collapsed:!1,backward:c,toString:function(){return"original text: '"+h+"', new text: '"+b.toString()+"'"}})}function h(d,f){var g=d.document;typeof f=="undefined"&&(f=!0);var h=a.createRange(g);if(d.collapsed){var i=c(d.markerId,g);if(i){i.style.display="inline";var j=i.previousSibling;j&&j.nodeType==3?(i.parentNode.removeChild(i),h.collapseToPoint(j,j.length)):(h.collapseBefore(i),i.parentNode.removeChild(i))}else b.warn("Marker element has been removed. Cannot restore selection.")}else e(g,h,d.startMarkerId,!0),e(g,h,d.endMarkerId,!1);return f&&h.normalizeBoundaries(),h}function i(b,d){var e=[],h,i;b=b.slice(0),b.sort(f);for(var j=0,k=b.length;j<k;++j)e[j]=g(b[j],d);for(j=k-1;j>=0;--j)h=b[j],i=a.DomRange.getRangeDocument(h),h.collapsed?h.collapseAfter(c(e[j].markerId,i)):(h.setEndBefore(c(e[j].endMarkerId,i)),h.setStartAfter(c(e[j].startMarkerId,i)));return e}function j(c){if(!a.isSelectionValid(c))return b.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus."),null;var d=a.getSelection(c),e=d.getAllRanges(),f=e.length==1&&d.isBackward(),g=i(e,f);return d.setRanges(e),{win:c,rangeInfos:g,restored:!1}}function k(a){var b=[],c=a.length;for(var d=c-1;d>=0;d--)b[d]=h(a[d],!0);return b}function l(b,c){if(!b.restored){var d=b.rangeInfos,e=a.getSelection(b.win),f=k(d),g=d.length;g==1&&c&&a.features.selectionHasExtend&&d[0].backward?(e.removeAllRanges(),e.addRange(f[0],!0)):e.setRanges(f),b.restored=!0}}function m(a,b){var d=c(b,a);d&&d.parentNode.removeChild(d)}function n(a){var b=a.rangeInfos;for(var c=0,d=b.length,e;c<d;++c)e=b[c],e.collapsed?m(a.doc,e.markerId):(m(a.doc,e.startMarkerId),m(a.doc,e.endMarkerId))}a.requireModules(["DomUtil","DomRange","WrappedRange"]);var o=a.dom,p="﻿";a.util.extend(a,{saveRange:g,restoreRange:h,saveRanges:i,restoreRanges:k,saveSelection:j,restoreSelection:l,removeMarkerElement:m,removeMarkers:n})});rangy.createModule("Coordinates",function(a,b){function g(a){var b=0,d=0;if(typeof a.pageXOffset==c&&typeof a.pageYOffset==c){b=a.pageXOffset;d=a.pageYOffset}else{var f=a.document;var g=f.documentElement;var h=f.compatMode;var i=typeof h=="string"&&h.indexOf("CSS")>=0&&g?g:e.getBody(f);if(i&&typeof i.scrollLeft==c&&typeof i.scrollTop==c){try{b=i.scrollLeft;d=i.scrollTop}catch(j){}}}return{x:b,y:d}}function h(a,b){b=b.toLowerCase();while(a){if(a.nodeType==1&&a.tagName.toLowerCase()==b){return a}a=a.parentNode}return null}function i(a,b,c,d){this.top=a;this.right=b;this.bottom=c;this.left=d;this.width=b-d;this.height=c-a}function j(a,b,c){return new i(a.top+c,a.right+b,a.bottom+c,a.left+b)}function k(a){return function(){var b=this["get"+(a?"Start":"End")+"ClientPos"]();var c=g(e.getWindow(this.startContainer));return{x:b.x+c.x,y:b.y+c.y}}}function l(a,b){var d=0,f=0;var g=b.documentElement,h=e.getBody(b);var i=g.clientWidth===0&&typeof h.clientTop==c?h:g;var k=i.clientLeft,l=i.clientTop;if(k){d=-k}if(l){f=-l}return j(a,d,f)}function m(a){var b=[],c=[],d=[],e=[];for(var f=0,g=a.length,h;f<g;++f){h=a[f];if(h){b.push(h.top);c.push(h.bottom);d.push(h.left);e.push(h.right)}}return new i(Math.min.apply(Math,b),Math.max.apply(Math,e),Math.max.apply(Math,c),Math.min.apply(Math,d))}a.requireModules(["WrappedSelection","WrappedRange"]);var c="number";var d=a.WrappedRange;var e=a.dom,f=a.util;(function(){var c=document.createElement("span");var n=f.isHostMethod(c,"getBoundingClientRect");c=null;var o=false,p=false;if(a.features.implementsDomRange){var q=a.createNativeRange();o=f.isHostMethod(q,"getClientRects");p=f.isHostMethod(q,"getBoundingClientRect");q.detach()}f.extend(a.features,{rangeSupportsGetBoundingClientRect:p,rangeSupportsGetClientRects:o,elementSupportsGetBoundingClientRect:n});var r=function(a){return function(){var b=this.cloneRange();b.collapse(a);var c=b.getBoundingClientRect();return{x:c[a?"left":"right"],y:c[a?"top":"bottom"]}}};var s=a.rangePrototype;if(a.features.implementsTextRange&&n){s.getBoundingClientRect=function(){var a=d.rangeToTextRange(this);var b=this.getNodes([1],function(a){return/^t[dh]$/i.test(a.tagName)});var c,f=[];if(b.length>0){var g=h(this.startContainer,"table");for(var i=0,j,k,n,o,p;j=b[i];++i){n=h(j,"table");if(!g||n!=g){o=this.cloneRange();if(g){o.setStartAfter(g)}o.setEndBefore(n);f.push(d.rangeToTextRange(o).getBoundingClientRect())}if(this.containsNode(j)){f.push(j.getBoundingClientRect())}else{k=a.duplicate();k.moveToElementText(j);if(k.compareEndPoints("StartToStart",a)==-1){k.setEndPoint("StartToStart",a)}else{if(k.compareEndPoints("EndToEnd",a)==1){k.setEndPoint("EndToEnd",a)}}f.push(k.getBoundingClientRect())}g=n}var q=h(this.endContainer,"table");if(!q&&g){o=this.cloneRange();o.setStartAfter(g);f.push(d.rangeToTextRange(o).getBoundingClientRect())}c=m(f)}else{c=a.getBoundingClientRect()}return l(c,e.getDocument(this.startContainer))}}else{if(a.features.implementsDomRange){var t=function(a){return a instanceof d?a:new d(a)};if(p){s.getBoundingClientRect=function(){var a=t(this).nativeRange;var b=a.getBoundingClientRect()||a.getClientRects()[0];return l(b,e.getDocument(this.startContainer))};if(o){var u=function(a,b){var c=a.childNodes};r=function(a){return function(){var c,d=t(this).nativeRange;var e=d.getClientRects();if(e.length==0&&n){if(a){}console.log(d,d.getClientRects(),d.getBoundingClientRect());if(this.collapsed&&this.startContainer.nodeType==1&&this.startOffset<this.startContainer.childNodes.length){var f=this.startContainer.childNodes[this.startOffset];if(f.getClientRects){console.log(f,f.getClientRects(),this.startContainer.getClientRects())}}}if(e.length>0){if(a){c=e[0];return{x:c.left,y:c.top}}else{c=e[e.length-1];return{x:c.right,y:c.bottom}}}else{throw b.createError("Cannot get position for range "+this.inspect())}}}}}else{var v=n?function(a){return l(a.getBoundingClientRect(),e.getDocument(a))}:function(a){var b=0,c=0,d=a,f=a.offsetWidth,g=a.offsetHeight;while(d){b+=d.offsetLeft;c+=d.offsetTop;d=d.offsetParent}return l(new i(c,b+f,c+g,b),e.getDocument(a))};var w=function(a){var b;a.splitBoundaries();var c=document.createElement("span");if(a.collapsed){a.insertNode(c);b=v(c);c.parentNode.removeChild(c)}else{var d=a.cloneRange();d.collapse(true);d.insertNode(c);var e=v(c);c.parentNode.removeChild(c);d.collapseToPoint(a.endContainer,a.endOffset);d.insertNode(c);var f=v(c);c.parentNode.removeChild(c);var g=[e,f];var h=a.getNodes([1],function(b){return a.containsNode(b)});for(var i=0,j=h.length;i<j;++i){g.push(v(h[i]))}b=m(g)}a.normalizeBoundaries();return b};s.getBoundingClientRect=function(a){return w(t(a))}}}}f.extend(s,{getBoundingDocumentRect:function(){var a=g(e.getWindow(this.startContainer));return j(this.getBoundingClientRect(),a.x,a.y)},getStartClientPos:r(true),getEndClientPos:r(false),getStartDocumentPos:k(true),getEndDocumentPos:k(false)})})();(function(){function b(a,b){return a.compareBoundaryPoints(b.START_TO_START,b)}function c(a){return function(){var b="getBounding"+(a?"Document":"Client")+"Rect";var c=[];for(var d=0,e=null,f;d<this.rangeCount;++d){c.push(this.getRangeAt(d)[b]())}return m(c)}}function d(a,c){return function(){if(this.rangeCount==0){return null}var d=c?"Document":"Client";var e=this.getAllRanges();if(e.length>1){e.sort(b)}return a?e[0]["getStart"+d+"Pos"]():e[e.length-1]["getEnd"+d+"Pos"]()}}f.extend(a.selectionPrototype,{getBoundingClientRect:c(false),getBoundingDocumentRect:c(true),getStartClientPos:d(true,false),getEndClientPos:d(false,false),getStartDocumentPos:d(true,true),getEndDocumentPos:d(false,true)})})()})